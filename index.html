<!--
  ğŸ“¦ æ¨¡çµ„ï¼šç¤¾ç•œè§£æ”¾å¡
  ğŸ•’ æœ€å¾Œæ›´æ–°ï¼š2025-06-14T04:08:54+08:00
  ğŸ§‘â€ğŸ’» ä½œè€…/æ›´æ–°è€…ï¼š@s123104
  ğŸ”¢ ç‰ˆæœ¬ï¼šv1.4.0
  ğŸ“ æ‘˜è¦ï¼šImprove chart updates, mobile quotes and iOS prompt
-->
<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />

    <!-- SEO: åŸºæœ¬ Meta æ¨™ç±¤ -->
    <title>ç¤¾ç•œè§£æ”¾å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ</title>
    <meta
      name="description"
      content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æã€æ•¸æ“šåŒ¯å‡ºèˆ‡ AI æ´å¯Ÿï¼Œæ˜¯ä½ æœ€ä½³çš„è·å ´å£“åŠ›ç®¡ç†å·¥å…·ã€‚"
    />
    <meta
      name="keywords"
      content="ç¤¾ç•œè§£æ”¾å¡, é›¢è·, é›†é»å¡, è·å ´å£“åŠ›, å·¥ä½œå¿ƒæƒ…, å­ä¸–, åŠ ç­, æ…£è€é—†, PWA, å‰ç«¯å·¥å…·, AIåˆ†æ"
    />
    <link rel="canonical" href="https://github.com/s123104/work-freedom-card" />

    <!-- SEO: Open Graph (for Facebook, LinkedIn, etc.) -->
    <meta property="og:title" content="ç¤¾ç•œè§£æ”¾å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ" />
    <meta
      property="og:description"
      content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æèˆ‡ AI æ´å¯Ÿã€‚"
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://github.com/s123104/work-freedom-card"
    />
    <meta
      property="og:image"
      content="https://s123104.github.io/web/og-image.png"
    />
    <!-- å»ºè­°æ‚¨åœ¨æ­¤è·¯å¾‘æ”¾ç½®ä¸€å¼µ 1200x630 çš„é è¦½åœ– -->
    <meta property="og:site_name" content="ç¤¾ç•œè§£æ”¾å¡" />
    <meta property="og:locale" content="zh_TW" />

    <!-- SEO: Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ç¤¾ç•œè§£æ”¾å¡ - ä½ çš„è·å ´ç”Ÿå­˜å£“åŠ›è¨ˆ" />
    <meta
      name="twitter:description"
      content="è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æèˆ‡ AI æ´å¯Ÿã€‚"
    />
    <meta
      name="twitter:image"
      content="https://s123104.github.io/web/og-image.png"
    />
    <!-- å»ºè­°æ‚¨åœ¨æ­¤è·¯å¾‘æ”¾ç½®ä¸€å¼µé©åˆ Twitter çš„é è¦½åœ– -->

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3da35d" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="ç¤¾ç•œè§£æ”¾å¡" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <link rel="icon" type="image/png" href="icon-192.png" />
    <link rel="manifest" href="./manifest.json" />

    <!-- SEO: JSON-LD Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ç¤¾ç•œè§£æ”¾å¡",
        "description": "è¨˜éŒ„æ¯æ—¥è·å ´å¿ƒæƒ…èˆ‡é³¥äº‹ï¼Œé›†æ»¿é›¢è·é»æ•¸ï¼Œé‚å‘è‡ªç”±ï¼æä¾›å­ä¸–æŒ‡æ•¸åˆ†æã€æ•¸æ“šåŒ¯å‡ºèˆ‡ AI æ´å¯Ÿï¼Œæ˜¯ä½ æœ€ä½³çš„è·å ´å£“åŠ›ç®¡ç†å·¥å…·ã€‚",
        "applicationCategory": "ProductivityApplication",
        "operatingSystem": "Web",
        "url": "https://github.com/s123104/work-freedom-card",
        "offers": { "@type": "Offer", "price": "0" },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "258"
        }
      }
    </script>

    <!-- Tailwind CSS -->
    <script>
      // å…§åµŒ Tailwind CSS ä»¥é¿å… CDN è­¦å‘Š
      (function() {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://cdn.tailwindcss.com/3.3.3/tailwind.min.css';
        document.head.appendChild(link);
      })();
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <!-- Google Fonts & Font Awesome Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Kalam:wght@400;700&family=Caveat:wght@400;600;700&family=Dancing+Script:wght@400;600;700&family=Indie+Flower&family=Shadows+Into+Light&family=Amatic+SC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9f4",
                100: "#dcf4e4",
                200: "#bbe8cc",
                300: "#8cd5a8",
                400: "#5bb97d",
                500: "#3da35d",
                600: "#2d8049",
                700: "#26663d",
                800: "#215233",
                900: "#1d432b",
              },
              secondary: {
                50: "#fefce8",
                100: "#fef9c3",
                200: "#fef08a",
                300: "#fde047",
                400: "#facc15",
                500: "#eab308",
                600: "#ca8a04",
                700: "#a16207",
                800: "#854d0e",
                900: "#713f12",
              },
              accent: {
                50: "#fdf2f8",
                100: "#fce7f3",
                200: "#fbcfe8",
                300: "#f9a8d4",
                400: "#f472b6",
                500: "#ec4899",
                600: "#db2777",
                700: "#be185d",
                800: "#9d174d",
                900: "#831843",
              },
              neutral: {
                50: "#fafafa",
                100: "#f5f5f5",
                200: "#e5e5e5",
                300: "#d4d4d4",
                400: "#a3a3a3",
                500: "#737373",
                600: "#525252",
                700: "#404040",
                800: "#262626",
                900: "#171717",
              },
            },
            fontFamily: {
              sans: ["Noto Sans TC", "sans-serif"],
              "handwrite-1": ["Kalam", "cursive"],
              "handwrite-2": ["Caveat", "cursive"],
              "handwrite-3": ["Dancing Script", "cursive"],
              "handwrite-4": ["Indie Flower", "cursive"],
              "handwrite-5": ["Shadows Into Light", "cursive"],
              "handwrite-6": ["Amatic SC", "cursive"],
            },
            animation: {
              "bounce-in":
                "bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)",
              "fade-in": "fadeIn 1s ease-out",
              "slide-up": "slideUp 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94)",
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              wiggle: "wiggle 1s ease-in-out infinite",
              float: "float 6s ease-in-out infinite",
              glow: "glow 2s ease-in-out infinite alternate",
              "quote-slide":
                "quoteSlide 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)",
              "quote-fade": "quoteFade 0.6s ease-out",
              "feedback-pop": "feedbackPop 2s ease-out forwards",
            },
          },
        },
      };
    </script>

    <style>
      * {
        touch-action: manipulation;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }
      input,
      textarea {
        -webkit-user-select: text;
        user-select: text;
      }
      .hidden {
        display: none;
      }

      @keyframes bounceIn {
        0% {
          opacity: 0;
          transform: scale(0.3) translateY(50px);
        }
        30% {
          opacity: 0.9;
          transform: scale(1.1);
        }
        60% {
          opacity: 1;
          transform: scale(0.89);
        }
        80% {
          transform: scale(1.05);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(60px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(100px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes wiggle {
        0%,
        7% {
          transform: rotateZ(0);
        }
        15% {
          transform: rotateZ(-15deg);
        }
        20% {
          transform: rotateZ(10deg);
        }
        25% {
          transform: rotateZ(-10deg);
        }
        30% {
          transform: rotateZ(6deg);
        }
        35% {
          transform: rotateZ(-4deg);
        }
        40%,
        100% {
          transform: rotateZ(0);
        }
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }
      @keyframes quoteSlide {
        from {
          opacity: 0;
          transform: translateY(-50px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes feedbackPop {
        0% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(0.5);
        }
        50% {
          transform: translate(-50%, -150%) scale(1.2);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -250%) scale(1.5);
        }
      }

      /* ç²’å­å‹•ç•« */
      @keyframes particleFade {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0);
        }
      }

      @keyframes collectPoint {
        0% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(0, -100px) scale(1.5);
        }
        100% {
          transform: translate(0, 0) scale(1);
        }
      }

      /* ç…™ç«å‹•ç•« */
      @keyframes firework {
        0% {
          transform: translate(-50%, 100vh);
          opacity: 1;
        }
        50% {
          transform: translate(-50%, 40vh);
          opacity: 1;
        }
        75% {
          transform: translate(-50%, 30vh);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, 30vh);
          opacity: 0;
        }
      }

      @keyframes explosion {
        0% {
          width: 4px;
          height: 4px;
          opacity: 1;
        }
        100% {
          width: 300px;
          height: 300px;
          opacity: 0;
        }
      }

      .firework {
        position: fixed;
        bottom: 0;
        left: 50%;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        animation: firework 1.5s ease-out forwards;
        z-index: 9999;
      }

      .explosion {
        position: absolute;
        top: 0;
        left: 0;
        transform: translate(-50%, -50%);
        width: 4px;
        height: 4px;
        border-radius: 50%;
        animation: explosion 1.5s ease-out forwards;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 1) 0%,
          rgba(255, 200, 0, 0.8) 100%
        );
        z-index: 9999;
      }

      .particle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        animation: particleFade 1s ease-out forwards;
        z-index: 100;
      }

      .grid-cell {
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        position: relative;
        overflow: hidden;
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border: 2px solid #e5e7eb;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        min-height: 40px;
      }
      .grid-cell:hover {
        transform: scale(1.08) translateY(-3px);
        box-shadow: 0 12px 35px rgba(61, 163, 93, 0.2);
        border-color: #3da35d;
        z-index: 10;
      }
      .grid-cell.filled {
        background: linear-gradient(145deg, #dcf4e4 0%, #bbe8cc 100%);
        border-color: #3da35d;
        box-shadow: 0 4px 15px rgba(61, 163, 93, 0.15);
      }
      .grid-cell.mood-money {
        background: linear-gradient(145deg, #fef9c3, #fde047);
        border-color: #ca8a04;
      }
      .grid-cell.mood-burnout {
        background: linear-gradient(145deg, #fecaca, #fca5a5);
        border-color: #ef4444;
      }
      .grid-cell.mood-annoying {
        background: linear-gradient(145deg, #e0e7ff, #c7d2fe);
        border-color: #6366f1;
      }
      .grid-cell.mood-stuck {
        background: linear-gradient(145deg, #e5e5e5, #d4d4d4);
        border-color: #737373;
      }
      .grid-cell.long-pressing {
        transform: scale(0.95);
        box-shadow: inset 0 4px 12px rgba(61, 163, 93, 0.2);
      }
      .date-text {
        color: #2d8049;
        font-weight: 700;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        transform: rotate(-2deg);
      }
      .grid-cell.mood-money .date-text {
        color: #a16207;
      }
      .grid-cell.mood-burnout .date-text {
        color: #b91c1c;
      }
      .grid-cell.mood-annoying .date-text {
        color: #4338ca;
      }
      .grid-cell.mood-stuck .date-text {
        color: #525252;
      }

      .glass-effect {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }
      .quote-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        padding: 24px;
        margin-top: 1.5rem;
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
      }
      #quoteDisplay {
        display: none;
      }
      #quoteDisplay.show {
        display: flex;
      }
      @media (max-width: 768px) {
        #quoteDisplay {
          position: fixed;
          bottom: 10px;
          left: 0;
          right: 0;
          justify-content: center;
          z-index: 1100;
        }
        #quoteDisplay .quote-container {
          margin-top: 0;
          width: calc(100% - 2rem);
        }
      }
      .progress-ring {
        transform: rotate(-90deg);
      }
      .progress-ring-circle {
        transition: stroke-dasharray 0.5s ease-in-out;
      }

      .modal-backdrop {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
      }
      .modal-content {
        background: white;
        border-radius: 24px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        transform: scale(0.9) translateY(20px);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        max-width: 90vw;
        max-height: 90vh;
        overflow-y: auto;
      }
      .modal-open .modal-content {
        transform: scale(1) translateY(0);
      }

      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb {
        background: #3da35d;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #2d8049;
      }
      @media (max-width: 768px) {
        .stats-container,
        .analysis-container {
          display: block !important;
        }
        .stats-container > div,
        .analysis-container > div {
          margin-bottom: 1.5rem;
        }
        .grid-cell {
          min-height: 35px;
        }
      }

      /* Share & AI Modal Styles */
      .share-trigger {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        background-color: #3da35d;
        color: white;
        border-radius: 50%;
        border: none;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
      }
      .share-trigger:hover {
        transform: scale(1.1);
        background-color: #2d8049;
      }
      .generic-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1050;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }
      .generic-modal.show {
        opacity: 1;
        visibility: visible;
      }
      .generic-modal .modal-box {
        background: #fff;
        border-radius: 16px;
        padding: 1.5rem;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        position: relative;
        text-align: center;
        transform: scale(0.95);
        transition: transform 0.3s;
      }
      .generic-modal.show .modal-box {
        transform: scale(1);
      }
      .generic-modal .close-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: transparent;
        border: none;
        font-size: 1.8rem;
        line-height: 1;
        cursor: pointer;
        color: #aaa;
      }
      #shareModal .share-options {
        margin: 1.5rem 0;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
      }
      #shareModal .share-btn {
        padding: 0.75rem;
        font-size: 0.9rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      #shareModal .share-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      #shareModal .share-btn--copy {
        background: #f3f3f3;
        color: #333;
      }
      #shareModal .share-btn--threads {
        background: #1c1c1c;
        color: #fff;
      }
      #shareModal .share-btn--twitter {
        background: #1da1f2;
        color: #fff;
      }
      #shareModal .share-btn--line {
        background: #00c300;
        color: #fff;
      }

      #aiExportModal #ai-prompt-output {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        width: 100%;
        min-height: 250px;
        font-family: monospace;
        font-size: 0.8rem;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      /* Annoyance Score Feedback */
      #annoyanceFeedback {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #ef4444;
        font-size: 2.5rem;
        font-weight: bold;
        text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3);
        pointer-events: none;
        z-index: 9999;
        animation: feedbackPop 2s ease-out forwards;
      }

      /* iOS PWA Install Prompt */
      #iosPwaModal .instruction-step {
        display: flex;
        align-items: center;
        text-align: left;
        margin-top: 1rem;
        padding: 0.75rem;
        background-color: #f3f4f6;
        border-radius: 8px;
      }
      #iosPwaModal .instruction-icon {
        font-size: 1.5rem;
        margin-right: 1rem;
        color: #3b82f6;
        width: 30px;
        text-align: center;
      }

      /* æˆå°±ç³»çµ±æ¨£å¼ */
      .achievement {
        background: linear-gradient(145deg, #f8fafc, #e2e8f0);
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .achievement-locked {
        filter: grayscale(1);
        opacity: 0.7;
      }

      .achievement-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 18px;
        color: white;
        flex-shrink: 0;
      }

      .achievement-content {
        flex-grow: 1;
      }

      .achievement-title {
        font-weight: 600;
        margin-bottom: 2px;
      }

      .achievement-description {
        font-size: 0.75rem;
        color: #64748b;
      }

      .achievement-locked .achievement-description:after {
        content: " (å°šæœªè§£é–)";
      }

      .achievement-unlocked-date {
        font-size: 0.7rem;
        color: #3da35d;
        margin-top: 2px;
      }

      .achievement-notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #3da35d, #2d8049);
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        z-index: 9999;
        display: flex;
        align-items: center;
        animation: slideDown 0.5s ease, fadeOut 0.5s ease 4.5s forwards;
        max-width: 90%;
      }

      @keyframes slideDown {
        from {
          transform: translate(-50%, -100px);
          opacity: 0;
        }
        to {
          transform: translate(-50%, 0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
          visibility: hidden;
        }
      }

      .achievement-notification-icon {
        font-size: 24px;
        margin-right: 12px;
      }

      .achievement-notification-content h4 {
        margin: 0 0 4px 0;
        font-size: 16px;
      }

      .achievement-notification-content p {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
      }

      .mood-option {
        border-radius: 8px;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: #f8fafc;
        margin-bottom: 8px;
      }
      
      .mood-option:hover {
        background-color: #f1f5f9;
        transform: translateY(-2px);
      }
      
      .mood-option.selected {
        background-color: #e2e8f0;
        border-left: 4px solid #3b82f6;
      }
      
      .mood-option i {
        font-size: 18px;
      }

      .animate-pop {
        animation: pop 0.5s ease-out;
      }
      
      @keyframes pop {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
      }
      
      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        transform: scale(0);
        animation: ripple-effect 0.8s ease-out;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
      }
      
      @keyframes ripple-effect {
        0% { transform: scale(0); opacity: 1; }
        100% { transform: scale(2); opacity: 0; }
      }

      .mood-error {
        border: 2px solid #ef4444;
        border-radius: 8px;
        animation: pulse-error 1.5s infinite;
      }
      
      @keyframes pulse-error {
        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
      }
      
      .mood-error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        font-weight: 500;
        display: flex;
        align-items: center;
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-primary-50 via-white to-accent-50 min-h-screen font-sans overflow-x-hidden"
  >
    <!-- Annoyance Score Feedback Element -->
    <div id="annoyanceFeedback" class="hidden"></div>

    <!-- Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
      <div
        class="absolute top-20 left-10 w-32 h-32 bg-primary-200 rounded-full opacity-20 animate-float"
      ></div>
      <div
        class="absolute bottom-20 right-20 w-24 h-24 bg-accent-200 rounded-full opacity-20 animate-float"
        style="animation-delay: -2s"
      ></div>
    </div>

    <!-- Header -->
    <header class="relative text-center py-6 sm:py-8 md:py-12 animate-fade-in">
      <div class="container mx-auto px-4">
        <h1
          class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-primary-800 mb-3 sm:mb-4 tracking-wide relative"
        >
          <span class="inline-block animate-wiggle">ğŸ“‹</span> é›¢è·é›†é»å¡
          <span class="inline-block animate-pulse-slow">âœ¨</span>
        </h1>
        <p
          class="text-base sm:text-lg md:text-xl text-primary-600 font-medium"
          id="progressText"
        >
          å…±100æ ¼ï¼Œé›†æ»¿é›¢è·
        </p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 pb-8">
      <!-- Grid Area -->
      <div
        class="glass-effect rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 mb-6 animate-slide-up"
      >
        <div class="text-center mb-4">
          <h2 class="text-xl sm:text-2xl font-bold text-primary-800 mb-2">
            <i class="fas fa-calendar-check mr-2"></i>æˆ‘çš„é›¢è·é›†é»é€²åº¦
          </h2>
          <p class="text-primary-600 text-xs sm:text-sm">
            <i class="fas fa-info-circle mr-1"></i>çŸ­æŒ‰æ¨™è¨˜æ—¥æœŸï¼Œ
            <span
              class="bg-primary-100 px-2 py-1 rounded-full font-bold animate-pulse"
              >é•·æŒ‰è¨˜éŒ„è©³ç´°äº‹ä»¶</span
            >
          </p>
        </div>
        <div
          class="grid grid-cols-8 md:grid-cols-10 gap-1 sm:gap-2 max-w-4xl mx-auto"
          id="gridContainer"
        ></div>
        <!-- Quote Display (Moved here) -->
        <div id="quoteDisplay" class="hidden">
          <div
            class="quote-container text-center fixed bottom-4 left-4 right-4 z-10 bg-gradient-to-r from-green-700/90 to-green-600/90 p-4 rounded-lg shadow-lg transform transition-all duration-300 max-w-md mx-auto"
          >
            <i class="fas fa-quote-left text-2xl mb-4 opacity-70"></i>
            <p
              class="text-lg sm:text-xl font-handwrite-3 leading-relaxed mb-4"
              id="quoteText"
            ></p>
            <button
              onclick="hideQuote()"
              class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm transition-all duration-300"
            >
              <i class="fas fa-times mr-2"></i>æ”¶èµ·
            </button>
          </div>
        </div>
      </div>

      <!-- Stats & Chart -->
      <div class="stats-container grid md:grid-cols-2 gap-4 mb-6">
        <div
          class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up"
          style="animation-delay: 0.2s"
        >
          <h3
            class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"
          >
            <i class="fas fa-chart-pie mr-2 text-primary-600"></i>é€²åº¦çµ±è¨ˆ
          </h3>
          <div class="flex items-center justify-center mb-4">
            <div class="relative w-24 h-24 sm:w-32 sm:h-32">
              <svg class="progress-ring w-full h-full" viewBox="0 0 120 120">
                <circle
                  cx="60"
                  cy="60"
                  r="54"
                  fill="none"
                  stroke="#e5e7eb"
                  stroke-width="8"
                />
                <circle
                  cx="60"
                  cy="60"
                  r="54"
                  fill="none"
                  stroke="#3da35d"
                  stroke-width="8"
                  stroke-linecap="round"
                  class="progress-ring-circle"
                  id="progressCircle"
                  stroke-dasharray="0 339.292"
                />
              </svg>
              <div
                class="absolute inset-0 flex items-center justify-center text-center"
              >
                <div>
                  <div
                    class="text-xl sm:text-2xl font-bold text-primary-700"
                    id="filledCount"
                  >
                    0
                  </div>
                  <div class="text-xs text-primary-600">å·²å®Œæˆ</div>
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-neutral-600"
                ><i class="fas fa-coins mr-2 text-yellow-500"></i>éŒ¢é€”èŒ«èŒ«</span
              ><span class="font-semibold text-yellow-600" id="moodMoneyCount"
                >0</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-neutral-600"
                ><i class="fas fa-tired mr-2 text-red-500"></i>èº«å¿ƒä¿±ç–²</span
              ><span class="font-semibold text-red-600" id="moodBurnoutCount"
                >0</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-neutral-600"
                ><i class="fas fa-angry mr-2 text-indigo-500"></i>é³¥äº‹ä¸€å †</span
              ><span
                class="font-semibold text-indigo-600"
                id="moodAnnoyingCount"
                >0</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-neutral-600"
                ><i class="fas fa-minus-circle mr-2 text-gray-500"></i
                >ç¼ºä¹æˆé•·</span
              ><span class="font-semibold text-gray-600" id="moodStuckCount"
                >0</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-neutral-600"
                ><i class="fas fa-percentage mr-2 text-accent-500"></i
                >å®Œæˆç‡</span
              ><span class="font-semibold text-accent-600" id="completionRate"
                >0%</span
              >
            </div>
          </div>
          <div class="mt-6 space-y-2">
            <button
              onclick="openAiExportModal()"
              class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-4 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105"
            >
              <i class="fas fa-magic-wand-sparkles mr-2"></i>åŒ¯å‡ºè‡³ AI åˆ†æ
            </button>
            <button
              onclick="openModal('achievementsModal'); renderAchievements();"
              class="w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white px-4 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105"
            >
              <i class="fas fa-trophy mr-2"></i>æŸ¥çœ‹é›¢è·æˆå°±
            </button>
            <button
              onclick="showClearConfirm()"
              class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105"
            >
              <i class="fas fa-trash-alt mr-2"></i>æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„
            </button>
          </div>
        </div>
        <div
          class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up"
          style="animation-delay: 0.4s"
        >
          <h3
            class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"
          >
            <i class="fas fa-chart-line mr-2 text-primary-600"></i>æ¯æ—¥è¶¨å‹¢
          </h3>
          <div class="relative h-64"><canvas id="dailyChart"></canvas></div>
          <p class="mt-4 text-center text-primary-600 text-xs sm:text-sm">
            <i class="fas fa-sync-alt fa-spin mr-1"></i
            >åœ–è¡¨å³æ™‚æ›´æ–°ï¼Œåæ˜ æœ€æ–°é›†é»ç‹€æ…‹
          </p>
        </div>
      </div>

      <!-- Analysis & Records -->
      <div class="analysis-container grid md:grid-cols-2 gap-4 mb-6">
        <div
          class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up"
          style="animation-delay: 0.6s"
        >
          <h3
            class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"
          >
            <i class="fas fa-fire-alt mr-2 text-red-500"></i>å­ä¸–æŒ‡æ•¸åˆ†æ
          </h3>
          <div class="bg-red-50 p-6 rounded-2xl text-center">
            <div class="text-sm text-red-700 mb-2">ç¸½å­ä¸–æŒ‡æ•¸</div>
            <div
              id="annoyanceIndexTotal"
              class="text-5xl font-bold text-red-600"
            >
              0
            </div>
            <p id="annoyanceLevel" class="text-red-500 font-semibold mt-2">
              å…§å¿ƒæ¯«ç„¡æ³¢ç€¾
            </p>
          </div>
          <div class="mt-4">
            <p class="text-sm text-neutral-600 mb-2 font-semibold">
              ä¸»è¦å­ä¸–ä¾†æºï¼š
            </p>
            <div
              id="topAnnoyanceKeywords"
              class="text-sm text-neutral-500 mb-3"
            >
              <div class="text-center py-4 text-neutral-500">å°šç„¡æ•¸æ“š</div>
            </div>
            <div id="keywordsPagination" class="flex justify-center mt-2"></div>
          </div>

          <!-- é—œéµå­—é›²å€å¡Š -->
          <div class="mt-6">
            <p
              class="text-sm text-neutral-600 mb-2 font-semibold flex items-center"
            >
              <i class="fas fa-cloud mr-2 text-blue-400"></i>å­ä¸–é—œéµå­—é›²
            </p>
            <div
              id="keywordCloud"
              class="bg-blue-50 p-4 rounded-xl min-h-[120px] flex items-center justify-center flex-wrap"
            >
              <p class="text-neutral-500 text-center">
                å°šç„¡è¶³å¤ æ•¸æ“šç”Ÿæˆé—œéµå­—é›²
              </p>
            </div>
          </div>
        </div>
        <div
          class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 animate-slide-up"
          style="animation-delay: 0.8s"
        >
          <h3
            class="text-lg sm:text-xl font-bold text-primary-800 mb-4 flex items-center"
          >
            <i class="fas fa-history mr-2 text-primary-600"></i>è¿‘æœŸè¨˜éŒ„
          </h3>
          <div id="recentRecords" class="space-y-3 max-h-64 overflow-y-auto">
            <p class="text-neutral-500 text-center py-8">
              <i class="fas fa-inbox text-3xl mb-2 block"></i>å°šç„¡è¨˜éŒ„
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer
      class="text-center py-6 text-primary-600 animate-fade-in"
      style="animation-delay: 1s"
    >
      <p class="text-sm sm:text-base mb-3 font-handwrite-4">
        äººç”Ÿè‹¦çŸ­ï¼Œåˆ¥æµªè²»åœ¨ä¸å–œæ­¡çš„åœ°æ–¹ã€‚
      </p>
      <p class="text-xs opacity-75 mb-2">
        Â© 2025 é›¢è·é›†é»å¡. All Rights Reserved.
      </p>
      <p class="text-xs opacity-75 mb-4">
        <a href="https://github.com/s123104/work-freedom-card" class="underline hover:text-primary-700" target="_blank">
          MIT License é–‹æºå°ˆæ¡ˆ by @s123104
        </a>
      </p>
    </footer>

    <!-- Share Button -->
    <button id="shareBtnTrigger" class="share-trigger" aria-label="åˆ†äº«æ­¤é é¢">
      <i class="fas fa-share-alt"></i>
    </button>

    <!-- Share Modal -->
    <div id="shareModal" class="generic-modal" aria-hidden="true" role="dialog">
      <div class="modal-box">
        <button
          class="close-btn"
          aria-label="é—œé–‰"
          onclick="closeModal('shareModal')"
        >
          Ã—
        </button>
        <h3 class="text-xl font-bold">åˆ†äº«ä½ çš„é›¢è·é€²åº¦</h3>
        <p class="mt-2 text-gray-600">è®“æœ‹å‹ä¸€èµ·è¦‹è­‰ä½ çš„è‡ªç”±ä¹‹è·¯ï¼</p>
        <p id="shareAnnoyanceIndex" class="text-red-600 font-semibold mt-1"></p>
        <div class="share-options">
          <button id="copyLinkBtn" class="share-btn share-btn--copy">
            <i class="fas fa-copy"></i>è¤‡è£½æ–‡æ¡ˆ
          </button>
          <button id="shareToThreadsBtn" class="share-btn share-btn--threads">
            <i class="fa-brands fa-threads"></i>Threads
          </button>
          <button id="shareToTwitterBtn" class="share-btn share-btn--twitter">
            <i class="fab fa-twitter"></i>Twitter
          </button>
          <button id="shareToLineBtn" class="share-btn share-btn--line">
            <i class="fab fa-line"></i>LINE
          </button>
        </div>
      </div>
    </div>

    <!-- AI Export Modal -->
    <div
      id="aiExportModal"
      class="generic-modal"
      aria-hidden="true"
      role="dialog"
    >
      <div class="modal-box" style="max-width: 600px">
        <button
          class="close-btn"
          aria-label="é—œé–‰"
          onclick="closeModal('aiExportModal')"
        >
          Ã—
        </button>
        <h3 class="text-xl font-bold mb-4 flex items-center justify-center">
          <i class="fas fa-magic-wand-sparkles mr-2 text-purple-500"></i>AI
          è·æ¶¯åˆ†æå¸«
        </h3>
        <p class="text-sm text-neutral-600 mb-4">
          å·²ç‚ºæ‚¨æ•´åˆå¥½ Promptï¼é»æ“Šä¸‹æ–¹æŒ‰éˆ•å³å¯è¤‡è£½å®Œæ•´å…§å®¹ï¼Œç›´æ¥è²¼åˆ° GPT /
          Claude / Gemini ç­‰ä»»ä½• AI èŠå¤©è¦–çª—ä¸­ï¼Œé–‹å§‹æ‚¨çš„è·æ¶¯åˆ†æã€‚
        </p>
        <textarea id="ai-prompt-output" readonly rows="10"></textarea>
        <button
          id="copyAIPromptBtn"
          class="w-full mt-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-4 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105"
        >
          <i class="fas fa-copy mr-2"></i>è¤‡è£½å®Œæ•´ Prompt
        </button>
      </div>
    </div>

    <!-- Event Modal -->
    <div
      id="eventModal"
      class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 p-4"
    >
      <div class="modal-content p-6 sm:p-8 w-full max-w-lg">
        <h3 class="text-xl font-bold text-primary-800 mb-4 text-center">
          è¨˜éŒ„å­ä¸–äº‹ä»¶
        </h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2"
              >æ—¥æœŸ</label
            >
            <input
              type="date"
              id="eventDate"
              class="w-full border-gray-300 rounded-lg"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2"
              >å¿ƒæƒ… (é›¢è·å››å¤§åŸå› )</label
            >
            <div id="moodSelector" class="space-y-2">
              <!-- ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div id="mood-error-message" class="mood-error-message hidden">
              <i class="fas fa-exclamation-circle mr-1"></i>
              è«‹é¸æ“‡ä¸€ç¨®å¿ƒæƒ…åˆ†é¡ï¼
            </div>
            <input type="hidden" id="selectedMood" value="" />
          </div>
          <div>
            <label
              for="eventDescription"
              class="block text-sm font-medium text-neutral-700 mb-2"
              >äº‹ä»¶æè¿°</label
            >
            <textarea
              id="eventDescription"
              rows="3"
              placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼é³¥äº‹ï¼Ÿ"
              class="w-full border-gray-300 rounded-lg"
            ></textarea>
            <div
              id="annoyanceFeedback"
              class="hidden mt-1 text-sm font-semibold text-red-500 animate-pulse"
            ></div>
          </div>
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2"
              >çˆ›äº‹æ¨™ç±¤</label
            >
            <div
              id="presetButtonsContainer"
              class="flex flex-wrap gap-2 mb-2"
            ></div>
            <div class="flex items-center gap-2">
              <div class="flex-grow relative">
                <input
                  type="text"
                  id="customPresetInput"
                  placeholder="æ–°å¢è‡ªè¨‚çˆ›äº‹"
                  class="w-full border-gray-300 rounded-lg pr-16"
                />
                <button
                  onclick="addCustomPreset()"
                  class="absolute right-0 top-0 bottom-0 bg-primary-500 text-white px-4 rounded-r-lg"
                >
                  æ–°å¢
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="flex gap-3 mt-6">
          <button
            onclick="closeEventModal()"
            class="flex-1 bg-neutral-200 text-neutral-700 py-3 rounded-xl"
          >
            å–æ¶ˆ
          </button>
          <button
            onclick="saveEvent()"
            class="flex-1 bg-primary-500 text-white py-3 rounded-xl"
          >
            å„²å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- Modals for Confirmation & PWA -->
    <div
      id="confirmModal"
      class="generic-modal"
      aria-hidden="true"
      role="dialog"
    >
      <div class="modal-box">
        <h3 class="text-xl font-bold">ç¢ºèªæ¸…ç©º</h3>
        <p class="my-4">æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œç¢ºå®šå—ï¼Ÿ</p>
        <div class="flex gap-4">
          <button
            class="flex-1 bg-gray-200 py-2 rounded-lg"
            onclick="closeModal('confirmModal')"
          >
            å–æ¶ˆ</button
          ><button
            class="flex-1 bg-red-500 text-white py-2 rounded-lg"
            onclick="confirmClearAll()"
          >
            ç¢ºèª
          </button>
        </div>
      </div>
    </div>
    <div id="installPrompt" class="hidden"></div>
    <!-- Generic PWA prompt, now mainly for Android -->
    <div
      id="iosPwaModal"
      class="generic-modal"
      aria-hidden="true"
      role="dialog"
    >
      <div class="modal-box">
        <button
          class="close-btn"
          aria-label="é—œé–‰"
          onclick="handleIosPwaClose()"
        >
          Ã—
        </button>
        <h3 class="text-xl font-bold">åŠ å…¥ä¸»ç•«é¢</h3>
        <p class="mt-2 text-gray-600">
          å°‡ã€Œç¤¾ç•œè§£æ”¾å¡ã€åŠ åˆ°ä¸»ç•«é¢ï¼Œåƒ App ä¸€æ¨£é«”é©—ï¼
        </p>
        <div class="mt-4 bg-blue-50 p-4 rounded-lg">
          <h4 class="font-bold text-blue-700 mb-2">ğŸš€ å®‰è£å¥½è™•</h4>
          <ul class="text-sm text-blue-800 space-y-1 list-disc pl-5">
            <li>ç„¡å»£å‘Šã€å…¨è¢å¹•ä½¿ç”¨é«”é©—</li>
            <li>é›¢ç·šä¹Ÿèƒ½è¨˜éŒ„å¿ƒæƒ…</li>
            <li>ä¸€éµé–‹å•Ÿï¼Œæ–¹ä¾¿å¿«é€Ÿ</li>
          </ul>
        </div>
        <div class="mt-4 bg-yellow-50 p-4 rounded-lg">
          <h4 class="font-bold text-yellow-700 mb-2">ğŸ“± ç°¡æ˜“å®‰è£æ­¥é©Ÿ</h4>
          <div class="flex items-center gap-3 mb-2">
            <div class="text-2xl text-yellow-600">1</div>
            <div>
              é»æ“Šåˆ†äº«æŒ‰éˆ• <i class="fas fa-share-square text-blue-500"></i>
            </div>
          </div>
          <div class="flex items-center gap-3 mb-2">
            <div class="text-2xl text-yellow-600">2</div>
            <div>
              é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<i
                class="fas fa-plus-square text-blue-500 ml-1"
              ></i>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="text-2xl text-yellow-600">3</div>
            <div>
              é»æ“Šã€Œæ–°å¢ã€å®Œæˆï¼<i
                class="fas fa-check-circle text-green-500 ml-1"
              ></i>
            </div>
          </div>
        </div>
        <div class="mt-4 flex items-center justify-center gap-2">
          <input type="checkbox" id="iosPwaDontShow" class="w-4 h-4" />
          <label for="iosPwaDontShow" class="text-sm text-gray-600"
            >ä¸‹æ¬¡ä¸å†æé†’</label
          >
        </div>
        <button
          class="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg"
          onclick="handleIosPwaClose()"
        >
          æˆ‘çŸ¥é“äº†
        </button>
      </div>
    </div>

    <!-- æˆå°±ç³»çµ± Modal -->
    <div
      id="achievementsModal"
      class="generic-modal"
      aria-hidden="true"
      role="dialog"
    >
      <div class="modal-box" style="max-width: 500px">
        <button
          class="close-btn"
          aria-label="é—œé–‰"
          onclick="closeModal('achievementsModal')"
        >
          Ã—
        </button>
        <h3 class="text-xl font-bold mb-4 flex items-center justify-center">
          <i class="fas fa-trophy mr-2 text-yellow-500"></i>é›¢è·æˆå°±ç³»çµ±
        </h3>
        <div class="text-sm text-neutral-600 mb-4 text-center">
          è§£é–å„ç¨®æˆå°±ï¼Œè¨˜éŒ„ä½ çš„é›¢è·ä¹‹è·¯ï¼
        </div>

        <div id="achievementsList" class="max-h-96 overflow-y-auto">
          <!-- æˆå°±å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <script>
      "use strict";
      // --- å…¨åŸŸè®Šæ•¸ ---
      let deferredPrompt;
      let filledDates = new Map();
      let customPresets = [];
      let longPressTimer = null;
      let isLongPress = false;
      let currentCell = null;
      let dailyChart = null;
      let quoteTimer = null;
      let handwriteFonts = [
        "font-handwrite-1",
        "font-handwrite-2",
        "font-handwrite-3",
        "font-handwrite-4",
        "font-handwrite-5",
        "font-handwrite-6",
      ];
      let achievements = new Map();

      const STORAGE_KEY = "resignationCard_v5";
      const PRESETS_KEY = "resignationCard_presets_v2";
      const ACHIEVEMENTS_KEY = "resignationCard_achievements_v1";
      const TOTAL_CELLS = 100;

      function toLocalDateStr(date) {
        return date.toLocaleDateString("en-CA");
      }

      // --- å¿ƒæƒ…åœ–ç¤º SVG ---
      const moodIcons = {
        money: `<svg viewBox="0 0 24 24" class="w-8 h-8 mx-auto stroke-current text-yellow-600"><path d="M9 10a1 1 0 11-2 0 1 1 0 012 0zm6 0a1 1 0 11-2 0 1 1 0 012 0zm-4 5a4 4 0 01-4-4h8a4 4 0 01-4 4zm4.5-8.5a1.5 1.5 0 00-3 0h3zm-4-3a.5.5 0 001 0h-1zM12 2a10 10 0 100 20 10 10 0 000-20z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>`,
        burnout: `<svg viewBox="0 0 24 24" class="w-8 h-8 mx-auto stroke-current text-red-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM9 15s1.5-2 3-2 3 2 3 2M9 9h.01M15 9h.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>`,
        annoying: `<svg viewBox="0 0 24 24" class="w-8 h-8 mx-auto stroke-current text-indigo-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM8 9l8 6M8 15L16 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>`,
        stuck: `<svg viewBox="0 0 24 24" class="w-8 h-8 mx-auto stroke-current text-gray-600"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zM9 12h6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>`,
      };

      // --- æ“´å……å¾Œçš„å­ä¸–æŒ‡æ•¸é—œéµå­—åº« ---
      const annoyanceKeywords = new Map([
        // å¼·çƒˆé«’è©± (10åˆ†)
        ["å¹¹ä½ å¨˜", 10],
        ["æ“ä½ åª½", 10],
        ["æ©Ÿæ°", 10],
        ["é›æ°", 10],
        ["ä¸‰å°", 10],
        // å¸¸è¦‹é«’è©± (8åˆ†)
        ["å¹¹", 8],
        ["æ“", 8],
        ["é ", 8],
        ["é æ¯", 8],
        ["é åŒ—", 8],
        ["åª½çš„", 8],
        ["åª½è›‹", 8],
        // ä¾®è¾±æ€§è©å½™ (7åˆ†)
        ["ç™½ç—´", 7],
        ["æ™ºéšœ", 7],
        ["è…¦æ®˜", 7],
        ["ä½èƒ½", 7],
        ["å»¢ç‰©", 7],
        ["åƒåœ¾", 7],
        ["åŒ—ä¸ƒ", 7],
        ["ç™½ç™¡", 7],
        // è·å ´è² é¢è¡Œç‚º (6åˆ†)
        ["ç”©é‹", 6],
        ["æ¨å¸", 6],
        ["å¸è²¬", 6],
        ["ç•«å¤§é¤…", 6],
        ["å‡¹äºº", 6],
        ["å£“æ¦¨", 6],
        ["æ…£è€é—†", 6],
        ["ç©ºé™", 6],
        // äººç‰©ç›¸é—œ (5åˆ†)
        ["è€é—†", 5],
        ["ä¸»ç®¡", 5],
        ["å®¢æˆ¶", 5],
        ["è€é—†å¨˜", 5],
        ["è±¬éšŠå‹", 5],
        ["å°äºº", 5],
        ["æ©Ÿè»Š", 5],
        ["é›æ­ª", 5],
        ["ç„¡èƒ½", 5],
        // å·¥ä½œå…§å®¹ (4åˆ†)
        ["åŠ ç­", 4],
        ["å ±å‘Š", 4],
        ["æœƒè­°", 4],
        ["é–‹æœƒ", 4],
        ["æ–‡ä»¶", 4],
        ["éœ€æ±‚", 4],
        ["æ”¹ä¾†æ”¹å»", 4],
        ["æ²’æ•ˆç‡", 4],
        // è–ªè³‡èˆ‡ç¦åˆ© (5åˆ†)
        ["è–ªæ°´", 5],
        ["åŠ è–ª", 5],
        ["å¹´çµ‚", 5],
        ["åˆ†ç´…", 5],
        ["ä½è–ª", 5],
        ["æ²’éŒ¢", 5],
        // æƒ…ç·’èˆ‡ç‹€æ…‹ (3åˆ†)
        ["ä¸çˆ½", 3],
        ["ç…©", 3],
        ["ç´¯", 3],
        ["å£“åŠ›", 3],
        ["å´©æ½°", 3],
        ["å¿ƒç´¯", 3],
        ["æƒ³æ­»", 3],
        ["ç—›è‹¦", 3],
        ["çµ•æœ›", 3],
        ["æ²’æ„ç¾©", 3],
        ["ç„¡åŠ›", 3],
        ["å€¦æ€ ", 3],
        ["é³¥äº‹", 3],
        ["çˆ›", 3],
        ["ç", 3],
        ["å‚»çœ¼", 3],
        // å…¶ä»–å°ç£å¸¸ç”¨èª (2-4åˆ†)
        ["æäº‹", 4],
        ["æœ‰äº‹å—", 3],
        ["ä¸‰å…«", 2],
        ["å“­å–”", 3],
        ["æ˜¯åœ¨å“ˆå›‰", 2],
        ["ç‚ä¸Š", 4],
        ["å‡ºåŒ…", 4],
        ["æ‰“æ§", 4],
        ["éŠƒåº·", 4],
      ]);

      // --- åˆå§‹åŒ– ---
      function init() {
        loadData();
        loadPresets();
        loadAchievements();
        updateAllStats();
        initChart();
        setupListeners();
        setupPWA();
        setupRipple();
        generateGrid();
        renderMoodIcons();

        // åˆå§‹æª¢æŸ¥æˆå°±
        checkAchievements();
      }

      document.addEventListener("DOMContentLoaded", () => {
        init();
      });

      // --- PWA & æ ¸å¿ƒåŠŸèƒ½ ---
      function checkAndShowPwaPrompt() {
        const isIOS =
          /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isInStandaloneMode =
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone;
        const optOut = localStorage.getItem("iosPwaPromptOptOut");

        if (isIOS && !isInStandaloneMode && optOut !== "true") {
          if (!localStorage.getItem("iosPwaPromptShown")) {
            openModal("iosPwaModal");
            localStorage.setItem("iosPwaPromptShown", "true");
          }
        } else {
          // Android æˆ–å…¶ä»–å¹³å°
          window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installPrompt = document.getElementById("installPrompt");
            installPrompt.classList.remove("hidden");
            installPrompt.onclick = installPWA;
          });
        }
      }
      async function installPWA() {
        if (deferredPrompt) deferredPrompt.prompt();
      }
      function handleIosPwaClose() {
        if (document.getElementById("iosPwaDontShow").checked) {
          localStorage.setItem("iosPwaPromptOptOut", "true");
        }
        closeModal("iosPwaModal");
      }
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            URL.createObjectURL(
              new Blob([`self.addEventListener('fetch', () => {})`], {
                type: "application/javascript",
              })
            )
          )
          .catch((err) => console.error("SW registration failed", err));
      }

      // --- è³‡æ–™è™•ç† ---
      function loadData() {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved) filledDates = new Map(JSON.parse(saved).dates || []);
          const savedPresets = localStorage.getItem(PRESETS_KEY);
          customPresets = savedPresets
            ? JSON.parse(savedPresets)
            : ["é–‹ä¸å®Œçš„æœƒ", "æ…£è€é—†", "è±¬éšŠå‹", "çªç™¼ä»»å‹™"];
        } catch (e) {
          console.error("è¼‰å…¥è³‡æ–™å¤±æ•—:", e);
        }
      }

      function saveData() {
        try {
          localStorage.setItem(
            STORAGE_KEY,
            JSON.stringify({ dates: Array.from(filledDates.entries()) })
          );
          localStorage.setItem(PRESETS_KEY, JSON.stringify(customPresets));
        } catch (e) {
          console.error("å„²å­˜è³‡æ–™å¤±æ•—:", e);
        }
      }

      // --- UI ç”Ÿæˆèˆ‡äº’å‹• ---
      function generateGrid() {
        const container = document.getElementById("gridContainer");
        container.innerHTML = "";

        for (let i = 0; i < TOTAL_CELLS; i++) {
          const cell = document.createElement("div");
          cell.className =
            "grid-cell aspect-square cursor-pointer flex items-center justify-center text-center relative";
          cell.dataset.index = i;

          // è¨­ç½®é•·æŒ‰å’Œé»æ“Šäº‹ä»¶
          cell.addEventListener("mousedown", (e) => startLongPress(e, i, cell));
          cell.addEventListener("touchstart", (e) => {
            e.preventDefault();
            startLongPress(e, i, cell);
          });
          cell.addEventListener("mouseup", endLongPress);
          cell.addEventListener("mouseleave", endLongPress);
          cell.addEventListener("touchend", endLongPress);
          cell.addEventListener("touchcancel", endLongPress);
          cell.addEventListener("click", () => handleCellClick(i, cell));

          container.appendChild(cell);
        }

        // æ¸²æŸ“å·²æœ‰æ•¸æ“š
        filledDates.forEach((data, index) => {
          const cell = container.querySelector(`[data-index="${index}"]`);
          if (cell) fillCell(cell, data);
        });
      }

      function setupEventListeners() {
        document
          .getElementById("gridContainer")
          .addEventListener("pointerdown", handlePointerDown);
        document
          .getElementById("gridContainer")
          .addEventListener("pointerup", handlePointerUp);
        document
          .getElementById("gridContainer")
          .addEventListener("pointerleave", cancelLongPress);
        document
          .getElementById("shareBtnTrigger")
          .addEventListener("click", () => openModal("shareModal"));
        document
          .getElementById("quoteDisplay")
          .addEventListener("click", hideQuote);
      }

      function handlePointerDown(e) {
        if (!e.target.closest(".grid-cell")) return;
        const cell = e.target.closest(".grid-cell");
        const index = parseInt(cell.dataset.index, 10);
        isLongPress = false;
        currentCell = cell;
        cell.classList.add("long-pressing");

        // æ·»åŠ è¦–è¦ºæç¤ºå…ƒç´ 
        const ripple = document.createElement("div");
        ripple.className =
          "absolute inset-0 bg-primary-300 rounded-md opacity-0 scale-0 transition-all duration-800";
        ripple.style.transform = "scale(0)";
        ripple.style.opacity = "0";
        cell.appendChild(ripple);

        // å‹•ç•«æ•ˆæœ
        setTimeout(() => {
          ripple.style.transform = "scale(0.8)";
          ripple.style.opacity = "0.3";
        }, 10);

        longPressTimer = setTimeout(() => {
          isLongPress = true;
          cell.classList.remove("long-pressing");
          // é•·æŒ‰å®Œæˆå¾Œç§»é™¤è¦–è¦ºæç¤º
          if (ripple && ripple.parentNode) {
            ripple.style.transform = "scale(1)";
            ripple.style.opacity = "0";
            setTimeout(() => ripple.remove(), 300);
          }
          openEventModal(index);
          if (navigator.vibrate) navigator.vibrate(50);
        }, 800);
      }

      function handlePointerUp(e) {
        if (!currentCell) return;
        const cell = e.target.closest(".grid-cell");
        const index = parseInt(currentCell.dataset.index, 10);
        clearTimeout(longPressTimer);
        currentCell.classList.remove("long-pressing");

        // ç§»é™¤æ‰€æœ‰è¦–è¦ºæç¤ºå…ƒç´ 
        const ripples = currentCell.querySelectorAll(".bg-primary-300");
        ripples.forEach((r) => r.remove());

        // æ·»åŠ é»æ“Šç²’å­æ•ˆæœ
        createParticles(e.clientX, e.clientY);

        if (!isLongPress) handleQuickMark(index, currentCell);
        currentCell = null;
      }

      // å‰µå»ºç²’å­æ•ˆæœ
      function createParticles(x, y) {
        const colors = ["#3da35d", "#eab308", "#ec4899", "#6366f1", "#ef4444"];
        const particlesCount = 15;

        for (let i = 0; i < particlesCount; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";

          // éš¨æ©Ÿå¤§å°
          const size = Math.floor(Math.random() * 8) + 4;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;

          // éš¨æ©Ÿé¡è‰²
          particle.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];

          // åˆå§‹ä½ç½®
          particle.style.left = `${x}px`;
          particle.style.top = `${y}px`;

          // éš¨æ©Ÿæ–¹å‘å’Œè·é›¢
          const angle = Math.random() * Math.PI * 2;
          const distance = Math.random() * 80 + 20;
          const velocityX = Math.cos(angle) * distance;
          const velocityY = Math.sin(angle) * distance;

          // è¨­å®šå‹•ç•«
          particle.style.transform = `translate(${velocityX}px, ${velocityY}px)`;

          document.body.appendChild(particle);

          // ç§»é™¤ç²’å­
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, 1000);
        }
      }

      function cancelLongPress() {
        clearTimeout(longPressTimer);
        if (currentCell) {
          currentCell.classList.remove("long-pressing");
          // ç§»é™¤æ‰€æœ‰è¦–è¦ºæç¤ºå…ƒç´ 
          const ripples = currentCell.querySelectorAll(".bg-primary-300");
          ripples.forEach((r) => r.remove());
        }
        currentCell = null;
      }

      function handleQuickMark(index, cell) {
        if (filledDates.has(index)) {
          clearCell(cell);
          filledDates.delete(index);
        } else {
          const today = new Date();
          const data = {
            date: toLocalDateStr(today),
            displayDate: `${today.getMonth() + 1}/${today.getDate()}`,
            mood: "burnout", // é è¨­ç‚ºèº«å¿ƒä¿±ç–²
            description: "",
            timestamp: today.toISOString(),
            fontStyle:
              handwriteFonts[Math.floor(Math.random() * handwriteFonts.length)],
            annoyanceIndex: 0,
          };
          fillCell(cell, data);
          filledDates.set(index, data);
          animateCell(cell);
          showRandomQuote();

          // æª¢æŸ¥æ˜¯å¦é›†æ»¿100é»
          if (filledDates.size === TOTAL_CELLS) {
            setTimeout(() => createFireworks(), 500);
            unlockAchievement("complete_all");
          }

          // æª¢æŸ¥æˆå°±
          checkAchievements();
        }
        saveData();
        updateAllStats();
      }

      function animateCell(cell) {
        cell.classList.add("animate-pop");
        setTimeout(() => cell.classList.remove("animate-pop"), 500);
      }

      function fillCell(cell, data) {
        const moodColors = {
          money: "#eab308", // é»ƒè‰²
          burnout: "#ef4444", // ç´…è‰²
          annoying: "#6366f1", // è—ç´«è‰²
          stuck: "#737373", // ç°è‰²
        };

        const color = moodColors[data.mood] || "#ef4444"; // é»˜èªç´…è‰²

        cell.style.backgroundColor = color;
        cell.style.color = "white";
        cell.classList.add("filled", data.fontStyle);
        cell.innerHTML = `<span>${data.displayDate}</span>`;
        cell.setAttribute("data-filled", "true");
        cell.setAttribute("data-date", data.date);
        cell.setAttribute("data-mood", data.mood);
        cell.setAttribute("data-description", data.description || "");
        cell.setAttribute("data-timestamp", data.timestamp);
        cell.setAttribute("data-annoyance", data.annoyanceIndex || 0);
      }

      function clearCell(cell) {
        cell.style.backgroundColor = "";
        cell.style.color = "";
        cell.classList.remove("filled");
        cell.classList.remove(...handwriteFonts);
        cell.innerHTML = "";
        cell.removeAttribute("data-filled");
        cell.removeAttribute("data-date");
        cell.removeAttribute("data-mood");
        cell.removeAttribute("data-description");
        cell.removeAttribute("data-timestamp");
        cell.removeAttribute("data-annoyance");
      }

      // ç…™ç«ç‰¹æ•ˆ
      function createFireworks() {
        const colors = [
          "#ff0000",
          "#00ff00",
          "#0000ff",
          "#ffff00",
          "#ff00ff",
          "#00ffff",
          "#ffffff",
        ];
        const fireworksCount = 5;

        for (let i = 0; i < fireworksCount; i++) {
          setTimeout(() => {
            const firework = document.createElement("div");
            firework.className = "firework";
            firework.style.backgroundColor =
              colors[Math.floor(Math.random() * colors.length)];
            firework.style.left = `${Math.random() * 80 + 10}%`;

            document.body.appendChild(firework);

            setTimeout(() => {
              const explosion = document.createElement("div");
              explosion.className = "explosion";
              explosion.style.top = firework.getBoundingClientRect().top + "px";
              explosion.style.left =
                firework.getBoundingClientRect().left + "px";
              document.body.appendChild(explosion);

              // ç…™ç«ç²’å­
              createFireworkParticles(
                explosion.getBoundingClientRect().left,
                explosion.getBoundingClientRect().top
              );

              setTimeout(() => {
                if (firework.parentNode)
                  firework.parentNode.removeChild(firework);
                if (explosion.parentNode)
                  explosion.parentNode.removeChild(explosion);
              }, 1500);
            }, 1000);
          }, i * 300);
        }
      }

      function createFireworkParticles(x, y) {
        const colors = [
          "#ff0000",
          "#ffa500",
          "#ffff00",
          "#00ff00",
          "#0000ff",
          "#4b0082",
          "#ee82ee",
        ];
        const particlesCount = 30;

        for (let i = 0; i < particlesCount; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";

          // éš¨æ©Ÿå¤§å°
          const size = Math.floor(Math.random() * 6) + 2;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;

          // éš¨æ©Ÿé¡è‰²
          particle.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];

          // åˆå§‹ä½ç½®
          particle.style.left = `${x}px`;
          particle.style.top = `${y}px`;

          // éš¨æ©Ÿæ–¹å‘å’Œè·é›¢
          const angle = Math.random() * Math.PI * 2;
          const distance = Math.random() * 150 + 50;
          const velocityX = Math.cos(angle) * distance;
          const velocityY = Math.sin(angle) * distance;

          // è¨­å®šå‹•ç•«
          particle.style.transform = `translate(${velocityX}px, ${velocityY}px)`;

          document.body.appendChild(particle);

          // ç§»é™¤ç²’å­
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, 1500);
        }
      }

      // --- äº‹ä»¶æ¨¡æ…‹çª— ---
      function openEventModal(index) {
        const modal = document.getElementById("eventModal");
        modal.dataset.currentIndex = index;
        const data = filledDates.get(index);
        document.getElementById("eventDate").value = data
          ? data.date
          : toLocalDateStr(new Date());
        document.getElementById("eventDescription").value = data
          ? data.description || ""
          : "";
        setMood(data ? data.mood : "money");
        modal.classList.remove("hidden");
        modal.classList.add("flex", "modal-open");
      }
      function closeEventModal() {
        document.getElementById("eventModal").classList.remove("modal-open");
        setTimeout(
          () => document.getElementById("eventModal").classList.add("hidden"),
          300
        );
      }
      function renderMoodIcons() {
        const container = document.getElementById("moodSelector");
        if (!container) return;
        
        container.innerHTML = `
          <div class="mood-option" data-mood="money">
            <i class="fas fa-coins text-yellow-500"></i>
            <span>éŒ¢é€”èŒ«èŒ«</span>
          </div>
          <div class="mood-option" data-mood="burnout">
            <i class="fas fa-tired text-red-500"></i>
            <span>èº«å¿ƒä¿±ç–²</span>
          </div>
          <div class="mood-option" data-mood="annoying">
            <i class="fas fa-angry text-indigo-500"></i>
            <span>é³¥äº‹ä¸€å †</span>
          </div>
          <div class="mood-option" data-mood="stuck">
            <i class="fas fa-minus-circle text-gray-500"></i>
            <span>ç¼ºä¹æˆé•·</span>
          </div>
        `;
        
        // æ·»åŠ é»æ“Šäº‹ä»¶
        document.querySelectorAll(".mood-option").forEach(option => {
          option.addEventListener("click", () => {
            document.querySelectorAll(".mood-option").forEach(el => 
              el.classList.remove("selected"));
            option.classList.add("selected");
            document.getElementById("selectedMood").value = option.dataset.mood;
          });
        });
      }
      function setMood(mood) {
        document.querySelectorAll(".mood-btn").forEach((btn) => {
          const isSelected = btn.dataset.mood === mood;
          btn.classList.toggle("selected", isSelected);
        });
      }

      function saveEvent() {
        const modal = document.getElementById("eventModal");
        const index = parseInt(modal.dataset.currentIndex, 10);
        if (isNaN(index)) {
          console.error("Save failed: Invalid index.");
          return;
        }
        
        // æª¢æŸ¥æ˜¯å¦é¸æ“‡äº†å¿ƒæƒ…
        const selectedMood = document.getElementById("selectedMood").value;
        if (!selectedMood) {
          // é¡¯ç¤ºç´…è‰²æ¡†æ¡†æç¤ºï¼Œä¸ä½¿ç”¨ç³»çµ±æç¤ºçª—
          const moodSelector = document.getElementById("moodSelector");
          moodSelector.classList.add("mood-error");
          document.getElementById("mood-error-message").classList.remove("hidden");
          return;
        }
        
        // ç§»é™¤éŒ¯èª¤æç¤º
        document.getElementById("moodSelector").classList.remove("mood-error");
        document.getElementById("mood-error-message").classList.add("hidden");
        
        const description = document.getElementById("eventDescription").value.trim();
        const score = calculateAnnoyanceIndex(description);
        if (score > 0) showAnnoyanceFeedback(score);
        
        const dateInput = document.getElementById("eventDate").value;
        const data = {
          date: dateInput,
          displayDate: `${new Date(dateInput).getMonth() + 1}/${new Date(dateInput).getDate()}`,
          mood: selectedMood,
          description,
          timestamp: new Date().toISOString(),
          fontStyle: filledDates.get(index)?.fontStyle || handwriteFonts[Math.floor(Math.random() * handwriteFonts.length)],
          annoyanceIndex: score,
        };
        
        const cell = document.querySelector(`[data-index="${index}"]`);
        fillCell(cell, data);
        filledDates.set(index, data);
        saveData();
        updateAllStats();
        checkAchievements(); // æª¢æŸ¥æ˜¯å¦è§£é–æˆå°±
        closeModal('eventModal');
      }

      function handleCellClick(index, cell) {
        if (isLongPress) {
          isLongPress = false;
          return;
        }
        
        // å¦‚æœå·²å¡«å……ï¼Œé¡¯ç¤ºè©³æƒ…
        if (filledDates.has(index)) {
          const data = filledDates.get(index);
          alert(`æ—¥æœŸ: ${data.date}\nå¿ƒæƒ…: ${getMoodName(data.mood)}\næè¿°: ${data.description || "(ç„¡æè¿°)"}\nå­ä¸–æŒ‡æ•¸: ${data.annoyanceIndex || 0}`);
          return;
        }
        
        // å¦å‰‡æ‰“é–‹ç·¨è¼¯æ¨¡æ…‹çª—
        const modal = document.getElementById("eventModal");
        modal.dataset.currentIndex = index;
        
        // è¨­ç½®ä»Šå¤©æ—¥æœŸ
        const today = new Date();
        const dateStr = toLocalDateStr(today);
        document.getElementById("eventDate").value = dateStr;
        
        // æ¸…ç©ºè¡¨å–®
        document.getElementById("selectedMood").value = "";
        document.getElementById("eventDescription").value = "";
        document.querySelectorAll(".mood-option").forEach(el => el.classList.remove("selected"));
        
        openModal("eventModal");
      }
      
      function getMoodName(mood) {
        const moodNames = {
          money: "éŒ¢é€”èŒ«èŒ«",
          burnout: "èº«å¿ƒä¿±ç–²",
          annoying: "é³¥äº‹ä¸€å †",
          stuck: "ç¼ºä¹æˆé•·"
        };
        return moodNames[mood] || mood;
      }

      function startLongPress(e, index, cell) {
        if (longPressTimer) clearTimeout(longPressTimer);
        isLongPress = false;
        currentCell = cell;
        
        longPressTimer = setTimeout(() => {
          isLongPress = true;
          handleQuickMark(index, cell);
          
          // æ·»åŠ æ¼£æ¼ªæ•ˆæœ
          const ripple = document.createElement("span");
          ripple.className = "ripple";
          cell.appendChild(ripple);
          
          // ç§»é™¤æ¼£æ¼ªæ•ˆæœ
          setTimeout(() => {
            if (ripple.parentNode) ripple.parentNode.removeChild(ripple);
          }, 1000);
        }, 500);
      }
      
      function endLongPress() {
        if (longPressTimer) clearTimeout(longPressTimer);
      }

      function updateAnnoyanceStats() {
        let total = 0;
        const counts = new Map();
        const allWords = new Map(); // ç”¨æ–¼é—œéµå­—é›²
        
        filledDates.forEach((d) => {
          total += d.annoyanceIndex || 0;
          if (d.description) {
            // åˆ†ææ¯å€‹å­—è©æ˜¯å¦åœ¨å­ä¸–é—œéµå­—åº«ä¸­
            const words = d.description.toLowerCase().split(/\s+/);
            words.forEach((word) => {
              if (word.length >= 2) { // å¿½ç•¥å–®å­—ç¬¦
                // æ›´æ–°æ‰€æœ‰å­—è©é »ç‡ (é—œéµå­—é›²ç”¨)
                allWords.set(word, (allWords.get(word) || 0) + 1);
                
                // æ›´æ–°å­ä¸–é—œéµå­—é »ç‡
                if (annoyanceKeywords.has(word)) {
                  counts.set(word, (counts.get(word) || 0) + 1);
                }
              }
            });
            
            // åˆ†æå¤šå­—è©é—œéµå­—
            Array.from(annoyanceKeywords.keys()).forEach((keyword) => {
              if (keyword.includes(" ") && d.description.toLowerCase().includes(keyword)) {
                counts.set(keyword, (counts.get(keyword) || 0) + 1);
              }
            });
          }
        });
        
        document.getElementById("annoyanceIndexTotal").textContent = total;
        document.getElementById("annoyanceLevel").textContent =
          total > 200 ? "åœ°ç„ç´šå­ä¸–" :
          total > 100 ? "é‡åº¦å­ä¸–" :
          total > 50 ? "ä¸­åº¦å­ä¸–" : "è¼•åº¦å­ä¸–";
        
        // æ›´æ–°å­ä¸–ä¾†æºåˆ—è¡¨ - åˆ†é å¼é¡¯ç¤º
        const allKeywords = Array.from(counts.entries())
          .sort((a, b) => b[1] - a[1]);
        
        const keywordsContainer = document.getElementById("topAnnoyanceKeywords");
        const paginationContainer = document.getElementById("keywordsPagination");
        
        if (allKeywords.length > 0) {
          renderKeywordsPage(keywordsContainer, allKeywords, 0);
          renderKeywordsPagination(paginationContainer, allKeywords);
        } else {
          keywordsContainer.innerHTML = `<div class="text-center py-4 text-neutral-500">å°šç„¡æ•¸æ“š</div>`;
          paginationContainer.innerHTML = '';
        }
        
        // ç”Ÿæˆé—œéµå­—é›²
        generateKeywordCloud(allWords);
      }
      
      function renderKeywordsPage(container, keywords, page) {
        const itemsPerPage = 15; // æ¯é é¡¯ç¤º15å€‹é—œéµå­—
        const startIndex = page * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, keywords.length);
        const pageKeywords = keywords.slice(startIndex, endIndex);
        
        container.innerHTML = '';
        
        if (pageKeywords.length === 0) {
          container.innerHTML = `<div class="text-center py-4 text-neutral-500">å°šç„¡æ•¸æ“š</div>`;
          return;
        }
        
        // å‰µå»º3åˆ—5è¡Œçš„ç¶²æ ¼
        const grid = document.createElement('div');
        grid.className = 'grid grid-cols-3 gap-2';
        
        pageKeywords.forEach(([keyword, count]) => {
          const item = document.createElement('div');
          item.className = 'bg-white/50 rounded-lg p-2 flex justify-between items-center';
          item.innerHTML = `
            <span class="text-xs text-neutral-700 truncate flex-1">${keyword}</span>
            <span class="bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-xs font-medium">${count}</span>
          `;
          grid.appendChild(item);
        });
        
        container.appendChild(grid);
      }
      
      function renderKeywordsPagination(container, keywords) {
        const itemsPerPage = 15;
        const pageCount = Math.ceil(keywords.length / itemsPerPage);
        
        if (pageCount <= 1) {
          container.innerHTML = '';
          return;
        }
        
        container.innerHTML = '';
        
        for (let i = 0; i < pageCount; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.className = 'w-8 h-8 rounded-full bg-neutral-200 hover:bg-neutral-300 mx-1';
          pageBtn.textContent = i + 1;
          pageBtn.onclick = () => {
            // ç§»é™¤æ‰€æœ‰æ´»èºç‹€æ…‹
            document.querySelectorAll('#keywordsPagination button').forEach(btn => {
              btn.classList.remove('bg-accent-500', 'text-white');
              btn.classList.add('bg-neutral-200');
            });
            
            // è¨­ç½®ç•¶å‰é ç‚ºæ´»èºç‹€æ…‹
            pageBtn.classList.remove('bg-neutral-200');
            pageBtn.classList.add('bg-accent-500', 'text-white');
            
            // æ¸²æŸ“å°æ‡‰é é¢
            renderKeywordsPage(document.getElementById('topAnnoyanceKeywords'), keywords, i);
          };
          
          // è¨­ç½®ç¬¬ä¸€é ç‚ºé»˜èªæ´»èºç‹€æ…‹
          if (i === 0) {
            pageBtn.classList.remove('bg-neutral-200');
            pageBtn.classList.add('bg-accent-500', 'text-white');
          }
          
          container.appendChild(pageBtn);
        }
      }

      function loadPresets() {
        try {
          const savedPresets = localStorage.getItem(PRESETS_KEY);
          if (savedPresets) {
            customPresets = JSON.parse(savedPresets);
          } else {
            // é è¨­æ¨™ç±¤
            customPresets = ["åŠ ç­", "é–‹ä¸å®Œçš„æœƒè­°", "çªç™¼ä»»å‹™", "ç„¡æ„ç¾©çš„å ±å‘Š", "ä¸»ç®¡äº‚ä¾†"];
            savePresets();
          }
        } catch (e) {
          console.error("è¼‰å…¥é è¨­æ¨™ç±¤å¤±æ•—:", e);
          customPresets = ["åŠ ç­", "é–‹ä¸å®Œçš„æœƒè­°", "çªç™¼ä»»å‹™", "ç„¡æ„ç¾©çš„å ±å‘Š", "ä¸»ç®¡äº‚ä¾†"];
        }
      }
      
      function savePresets() {
        try {
          localStorage.setItem(PRESETS_KEY, JSON.stringify(customPresets));
        } catch (e) {
          console.error("å„²å­˜é è¨­æ¨™ç±¤å¤±æ•—:", e);
        }
      }

      // è¨»å†Š Service Worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(registration => {
              console.log('SW registered: ', registration);
            })
            .catch(error => {
              console.log('SW registration failed: ', error);
            });
        });
      }

      function loadAchievements() {
        try {
          const savedAchievements = localStorage.getItem(ACHIEVEMENTS_KEY);
          if (savedAchievements) {
            achievements = new Map(JSON.parse(savedAchievements));
          }
        } catch (e) {
          console.error("è¼‰å…¥æˆå°±å¤±æ•—:", e);
          achievements = new Map();
        }
      }
      
      function saveAchievements() {
        try {
          localStorage.setItem(ACHIEVEMENTS_KEY, JSON.stringify(Array.from(achievements.entries())));
        } catch (e) {
          console.error("å„²å­˜æˆå°±å¤±æ•—:", e);
        }
      }
      
      function unlockAchievement(id) {
        if (achievements.has(id)) return; // å·²è§£é–
        
        const achievementData = {
          id,
          unlockedAt: new Date().toISOString()
        };
        
        achievements.set(id, achievementData);
        saveAchievements();
        
        // é¡¯ç¤ºæˆå°±é€šçŸ¥
        showAchievementNotification(id);
      }
      
      function showAchievementNotification(id) {
        const achievementInfo = getAchievementInfo(id);
        if (!achievementInfo) return;
        
        const notification = document.createElement('div');
        notification.className = 'achievement-notification';
        notification.innerHTML = `
          <div class="achievement-notification-icon">ğŸ†</div>
          <div class="achievement-notification-content">
            <h4>æˆå°±è§£é–ï¼</h4>
            <p>${achievementInfo.title}</p>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 5000);
      }
      
      function getAchievementInfo(id) {
        const achievementsInfo = {
          "first_record": {
            title: "åˆæ¬¡ç´€éŒ„",
            description: "è¨˜éŒ„ç¬¬ä¸€å€‹å­ä¸–äº‹ä»¶",
            icon: "fa-pencil-alt",
            color: "#3b82f6"
          },
          "first_burnout": {
            title: "èº«å¿ƒä¿±ç–²",
            description: "ç¬¬ä¸€æ¬¡è¨˜éŒ„èº«å¿ƒä¿±ç–²",
            icon: "fa-tired",
            color: "#ef4444"
          },
          "first_money": {
            title: "éŒ¢é€”èŒ«èŒ«",
            description: "ç¬¬ä¸€æ¬¡è¨˜éŒ„éŒ¢é€”èŒ«èŒ«",
            icon: "fa-coins",
            color: "#eab308"
          },
          "first_annoying": {
            title: "é³¥äº‹ä¸€å †",
            description: "ç¬¬ä¸€æ¬¡è¨˜éŒ„é³¥äº‹ä¸€å †",
            icon: "fa-angry",
            color: "#6366f1"
          },
          "first_stuck": {
            title: "ç¼ºä¹æˆé•·",
            description: "ç¬¬ä¸€æ¬¡è¨˜éŒ„ç¼ºä¹æˆé•·",
            icon: "fa-minus-circle",
            color: "#737373"
          },
          "high_annoyance": {
            title: "æ¥µåº¦å­ä¸–",
            description: "å–®æ¬¡å­ä¸–æŒ‡æ•¸è¶…é 15 åˆ†",
            icon: "fa-fire",
            color: "#dc2626"
          },
          "collector": {
            title: "æ”¶é›†æ§",
            description: "æ”¶é›†è¶…é 30 å€‹å­ä¸–é»æ•¸",
            icon: "fa-trophy",
            color: "#8b5cf6"
          },
          "half_way": {
            title: "åŠè·¯é›¢è·",
            description: "æ”¶é›†è¶…é 50 å€‹å­ä¸–é»æ•¸",
            icon: "fa-flag-checkered",
            color: "#f59e0b"
          },
          "almost_there": {
            title: "å³å°‡è§£è„«",
            description: "æ”¶é›†è¶…é 90 å€‹å­ä¸–é»æ•¸",
            icon: "fa-door-open",
            color: "#10b981"
          },
          "complete_all": {
            title: "ç¤¾ç•œè§£æ”¾",
            description: "æ”¶é›†æ»¿ 100 å€‹å­ä¸–é»æ•¸",
            icon: "fa-crown",
            color: "#f97316"
          }
        };
        
        return achievementsInfo[id];
      }
      
      function checkAchievements() {
        const filledCount = filledDates.size;
        
        // æª¢æŸ¥é¦–æ¬¡è¨˜éŒ„
        if (filledCount > 0) {
          unlockAchievement("first_record");
        }
        
        // æª¢æŸ¥æ”¶é›†ç›¸é—œæˆå°±
        if (filledCount >= 30) unlockAchievement("collector");
        if (filledCount >= 50) unlockAchievement("half_way");
        if (filledCount >= 90) unlockAchievement("almost_there");
        if (filledCount >= 100) unlockAchievement("complete_all");
        
        // æª¢æŸ¥å„ç¨®å¿ƒæƒ…é¡å‹
        let hasMoney = false;
        let hasBurnout = false;
        let hasAnnoying = false;
        let hasStuck = false;
        let highAnnoyance = false;
        
        filledDates.forEach(data => {
          if (data.mood === "money") hasMoney = true;
          if (data.mood === "burnout") hasBurnout = true;
          if (data.mood === "annoying") hasAnnoying = true;
          if (data.mood === "stuck") hasStuck = true;
          if (data.annoyanceIndex && data.annoyanceIndex >= 15) highAnnoyance = true;
        });
        
        if (hasMoney) unlockAchievement("first_money");
        if (hasBurnout) unlockAchievement("first_burnout");
        if (hasAnnoying) unlockAchievement("first_annoying");
        if (hasStuck) unlockAchievement("first_stuck");
        if (highAnnoyance) unlockAchievement("high_annoyance");
      }
      
      function renderAchievements() {
        const container = document.getElementById("achievementsList");
        if (!container) return;
        
        container.innerHTML = "";
        
        // ç²å–æ‰€æœ‰æˆå°±ä¿¡æ¯
        const allAchievements = [
          "first_record", "first_money", "first_burnout", 
          "first_annoying", "first_stuck", "high_annoyance",
          "collector", "half_way", "almost_there", "complete_all"
        ];
        
        allAchievements.forEach(id => {
          const info = getAchievementInfo(id);
          const isUnlocked = achievements.has(id);
          const unlockedData = isUnlocked ? achievements.get(id) : null;
          
          const achievementEl = document.createElement("div");
          achievementEl.className = `achievement ${isUnlocked ? "" : "achievement-locked"}`;
          
          achievementEl.innerHTML = `
            <div class="achievement-icon" style="background-color: ${info.color}">
              <i class="fas ${info.icon}"></i>
            </div>
            <div class="achievement-content">
              <div class="achievement-title">${info.title}</div>
              <div class="achievement-description">${info.description}</div>
              ${isUnlocked ? `<div class="achievement-unlocked-date">è§£é–æ–¼ ${new Date(unlockedData.unlockedAt).toLocaleDateString()}</div>` : ""}
            </div>
          `;
          
          container.appendChild(achievementEl);
        });
      }

      function setupListeners() {
        document
          .getElementById("shareBtnTrigger")
          .addEventListener("click", () => openModal("shareModal"));
      }

      function setupRipple() {
        // æ·»åŠ æ¼£æ¼ªæ•ˆæœ
        document.addEventListener('click', function(e) {
          if (e.target.closest('.grid-cell')) {
            const cell = e.target.closest('.grid-cell');
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            cell.appendChild(ripple);
            
            setTimeout(() => {
              if (ripple.parentNode) ripple.parentNode.removeChild(ripple);
            }, 1000);
          }
        });
      }
      
      function setupPWA() {
        checkAndShowPwaPrompt();
      }
      
      function updateAllStats() {
        const filledCount = filledDates.size;
        document.getElementById("filledCount").textContent = filledCount;
        document.getElementById("completionRate").textContent = `${Math.round(
          (filledCount / TOTAL_CELLS) * 100
        )}%`;
        
        // æ›´æ–°é€²åº¦ç’°
        const progressCircle = document.getElementById("progressCircle");
        const circumference = 2 * Math.PI * 54; // åœ“çš„å‘¨é•·
        const offset = circumference - (filledCount / TOTAL_CELLS) * circumference;
        progressCircle.style.strokeDasharray = `${circumference - offset} ${offset}`;
        
        // æ›´æ–°å„ç¨®å¿ƒæƒ…æ•¸é‡
        let moodMoney = 0;
        let moodBurnout = 0;
        let moodAnnoying = 0;
        let moodStuck = 0;
        
        filledDates.forEach((data) => {
          if (data.mood === "money") moodMoney++;
          else if (data.mood === "burnout") moodBurnout++;
          else if (data.mood === "annoying") moodAnnoying++;
          else if (data.mood === "stuck") moodStuck++;
        });
        
        document.getElementById("moodMoneyCount").textContent = moodMoney;
        document.getElementById("moodBurnoutCount").textContent = moodBurnout;
        document.getElementById("moodAnnoyingCount").textContent = moodAnnoying;
        document.getElementById("moodStuckCount").textContent = moodStuck;
        
        // æ›´æ–°åœ–è¡¨
        if (dailyChart) updateChart();
        
        // æ›´æ–°å­ä¸–æŒ‡æ•¸çµ±è¨ˆ
        updateAnnoyanceStats();
        
        // æ›´æ–°è¿‘æœŸè¨˜éŒ„
        updateRecentRecords();
      }

      function updateChart() {
        if (!dailyChart) return;
        
        // ç²å–æœ€è¿‘ 30 å¤©çš„æ•¸æ“š
        const today = new Date();
        const dates = [];
        const datasets = [
          { label: "éŒ¢é€”èŒ«èŒ«", data: [], backgroundColor: "#eab308" },
          { label: "èº«å¿ƒä¿±ç–²", data: [], backgroundColor: "#ef4444" },
          { label: "é³¥äº‹ä¸€å †", data: [], backgroundColor: "#6366f1" },
          { label: "ç¼ºä¹æˆé•·", data: [], backgroundColor: "#737373" },
        ];
        
        // ç”Ÿæˆæœ€è¿‘ 30 å¤©çš„æ—¥æœŸ
        for (let i = 29; i >= 0; i--) {
          const d = new Date(today);
          d.setDate(d.getDate() - i);
          dates.push(d.toLocaleDateString("zh-TW", { month: "short", day: "numeric" }));
          
          // åˆå§‹åŒ–æ¯å¤©çš„æ•¸æ“šç‚º 0
          datasets.forEach(ds => ds.data.push(0));
        }
        
        // è¨ˆç®—æ¯å¤©çš„å¿ƒæƒ…æ•¸é‡
        filledDates.forEach(data => {
          const recordDate = new Date(data.date);
          const diffTime = today.getTime() - recordDate.getTime();
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays <= 29) {
            const index = 29 - diffDays;
            
            if (data.mood === "money") datasets[0].data[index]++;
            else if (data.mood === "burnout") datasets[1].data[index]++;
            else if (data.mood === "annoying") datasets[2].data[index]++;
            else if (data.mood === "stuck") datasets[3].data[index]++;
          }
        });
        
        // æ›´æ–°åœ–è¡¨æ•¸æ“š
        dailyChart.data.labels = dates;
        dailyChart.data.datasets = datasets;
        dailyChart.update();
      }
      
      function updateRecentRecords() {
        const container = document.getElementById("recentRecords");
        if (!container) return;
        
        // ç²å–æœ€è¿‘çš„è¨˜éŒ„
        const records = Array.from(filledDates.entries())
          .map(([index, data]) => ({ index, ...data }))
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
          .slice(0, 5);
        
        if (records.length === 0) {
          container.innerHTML = `
            <p class="text-neutral-500 text-center py-8">
              <i class="fas fa-inbox text-3xl mb-2 block"></i>å°šç„¡è¨˜éŒ„
            </p>
          `;
          return;
        }
        
        container.innerHTML = "";
        
        records.forEach(record => {
          const date = new Date(record.date);
          const formattedDate = date.toLocaleDateString("zh-TW", {
            year: "numeric",
            month: "long",
            day: "numeric",
            weekday: "short"
          });
          
          const moodEmoji = {
            money: '<i class="fas fa-coins text-yellow-500"></i>',
            burnout: '<i class="fas fa-tired text-red-500"></i>',
            annoying: '<i class="fas fa-angry text-indigo-500"></i>',
            stuck: '<i class="fas fa-minus-circle text-gray-500"></i>'
          };
          
          const moodNames = {
            money: "éŒ¢é€”èŒ«èŒ«",
            burnout: "èº«å¿ƒä¿±ç–²",
            annoying: "é³¥äº‹ä¸€å †",
            stuck: "ç¼ºä¹æˆé•·"
          };
          
          const recordEl = document.createElement("div");
          recordEl.className = "bg-white/50 rounded-lg p-3 shadow-sm";
          recordEl.innerHTML = `
            <div class="flex items-center justify-between mb-1">
              <div class="text-sm font-semibold text-neutral-700">${formattedDate}</div>
              <div class="text-xs text-neutral-500">#${record.index + 1}</div>
            </div>
            <div class="flex items-center gap-2">
              ${moodEmoji[record.mood]}
              <span class="text-sm">${moodNames[record.mood]}</span>
            </div>
            ${record.description ? `<p class="text-xs text-neutral-600 mt-1">${record.description}</p>` : ''}
          `;
          
          container.appendChild(recordEl);
        });
      }
      
      function initChart() {
        const ctx = document.getElementById("dailyChart").getContext("2d");
        dailyChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: [],
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
                labels: {
                  boxWidth: 12,
                  usePointStyle: true,
                  pointStyle: "circle"
                }
              },
              tooltip: {
                mode: "index",
                intersect: false
              }
            },
            scales: {
              x: {
                stacked: true,
                grid: {
                  display: false
                }
              },
              y: {
                stacked: true,
                beginAtZero: true,
                ticks: {
                  stepSize: 1
                }
              }
            }
          }
        });
      }

      function generateKeywordCloud(words) {
        const container = document.getElementById("keywordCloud");
        if (!container) return;
        
        // åªå–å‡ºç¾é »ç‡æœ€é«˜çš„å‰ 20 å€‹è©
        const topWords = Array.from(words.entries())
          .sort((a, b) => b[1] - a[1])
          .slice(0, 20);
        
        if (topWords.length < 5) {
          container.innerHTML = `<p class="text-neutral-500 text-center">å°šç„¡è¶³å¤ æ•¸æ“šç”Ÿæˆé—œéµå­—é›²</p>`;
          return;
        }
        
        container.innerHTML = "";
        
        // æ‰¾å‡ºæœ€é«˜é »ç‡ï¼Œç”¨æ–¼è¨ˆç®—å­—é«”å¤§å°
        const maxCount = topWords[0][1];
        
        topWords.forEach(([word, count]) => {
          // è¨ˆç®—ç›¸å°å¤§å° (1-5)
          const size = 1 + Math.floor((count / maxCount) * 4);
          const fontSize = 0.7 + (size * 0.15); // 0.85 - 1.45rem
          
          // éš¨æ©Ÿé¡è‰²
          const colors = ["#3b82f6", "#ef4444", "#10b981", "#f59e0b", "#8b5cf6", "#ec4899"];
          const color = colors[Math.floor(Math.random() * colors.length)];
          
          const wordSpan = document.createElement("span");
          wordSpan.className = "inline-block m-1 px-2 py-1 rounded-lg";
          wordSpan.style.fontSize = `${fontSize}rem`;
          wordSpan.style.color = color;
          wordSpan.style.backgroundColor = `${color}10`;
          wordSpan.style.border = `1px solid ${color}30`;
          wordSpan.textContent = word;
          
          container.appendChild(wordSpan);
        });
      }
      
      function calculateAnnoyanceIndex(text) {
        if (!text) return 0;
        
        let score = 0;
        const lowerText = text.toLowerCase();
        
        // æª¢æŸ¥æ¯å€‹é—œéµå­—
        annoyanceKeywords.forEach((value, keyword) => {
          if (lowerText.includes(keyword.toLowerCase())) {
            score += value;
          }
        });
        
        // æª¢æŸ¥å¥å­é•·åº¦å’Œæ¨™é»ç¬¦è™Ÿ
        const exclamationCount = (text.match(/!/g) || []).length;
        score += exclamationCount * 0.5;
        
        // æª¢æŸ¥å…¨å¤§å¯«å–®è© (è¡¨ç¤ºæ†¤æ€’)
        const upperCaseWords = text.match(/\b[A-Z]{3,}\b/g) || [];
        score += upperCaseWords.length * 1.5;
        
        return Math.round(score);
      }
      
      function showAnnoyanceFeedback(score) {
        const feedback = document.getElementById("annoyanceFeedback");
        feedback.textContent = `+${score}`;
        feedback.classList.remove("hidden");
        
        // é‡ç½®å‹•ç•«
        feedback.style.animation = 'none';
        feedback.offsetHeight; // è§¸ç™¼é‡ç¹ª
        feedback.style.animation = 'feedbackPop 2s ease-out forwards';
        
        // 5ç§’å¾Œéš±è—
        setTimeout(() => {
          feedback.classList.add("hidden");
        }, 2000);
      }
      
      function showRandomQuote() {
        const quotes = [
          "äººç”Ÿå¤ªçŸ­æš«ï¼Œåˆ¥æµªè²»åœ¨ä¸å–œæ­¡çš„åœ°æ–¹ã€‚",
          "é›¢è·ä¸æ˜¯çµæŸï¼Œè€Œæ˜¯æ–°ç”Ÿæ´»çš„é–‹å§‹ã€‚",
          "å¦‚æœä½ ä¸å–œæ­¡ç¾åœ¨çš„å·¥ä½œï¼Œé‚£å°±é›¢é–‹å§ï¼Œä¸–ç•Œå¾ˆå¤§ã€‚",
          "æ¯ä¸€æ¬¡çš„é›¢è·ï¼Œéƒ½æ˜¯ç‚ºäº†æ›´å¥½çš„ç›¸é‡ã€‚",
          "ç•¶å·¥ä½œä¸å†å¸¶çµ¦ä½ å¿«æ¨‚ï¼Œé›¢é–‹æ˜¯æœ€å¥½çš„é¸æ“‡ã€‚",
          "å‹‡æ•¢èªªä¸ï¼Œç‚ºè‡ªå·±çš„äººç”Ÿè² è²¬ã€‚",
          "é›¢è·æ˜¯ä¸€ç¨®å‹‡æ°£ï¼Œä¹Ÿæ˜¯ä¸€ç¨®æ™ºæ…§ã€‚",
          "ä¸è¦å®³æ€•æ”¹è®Šï¼Œæœ€ç³Ÿç³•çš„æ˜¯ä¸€æˆä¸è®Šçš„ç”Ÿæ´»ã€‚",
          "ç”Ÿå‘½å¤ªéçŸ­æš«ï¼Œä¸è¦æµªè²»åœ¨å§”å±ˆä¸Šã€‚",
          "ä½ çš„åƒ¹å€¼é ä¸æ­¢æ–¼æ­¤ï¼Œå»å°‹æ‰¾çœŸæ­£æ¬£è³ä½ çš„åœ°æ–¹ã€‚",
        ];
        
        const quoteDisplay = document.getElementById("quoteDisplay");
        const quoteText = document.getElementById("quoteText");
        
        // éš¨æ©Ÿé¸æ“‡ä¸€å¥è©±
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        quoteText.textContent = randomQuote;
        
        // é¡¯ç¤ºå¼•è¨€
        quoteDisplay.classList.remove("hidden");
        
        // è¨­ç½®å®šæ™‚å™¨ï¼Œ10ç§’å¾Œéš±è—
        if (quoteTimer) clearTimeout(quoteTimer);
        quoteTimer = setTimeout(hideQuote, 10000);
      }
      
      function hideQuote() {
        document.getElementById("quoteDisplay").classList.add("hidden");
        if (quoteTimer) clearTimeout(quoteTimer);
      }
      
      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add("show");
          
          // å¦‚æœæ˜¯åˆ†äº«æ¨¡æ…‹çª—ï¼Œè¨­ç½®åˆ†äº«å…§å®¹
          if (modalId === "shareModal") {
            setupShareContent();
          } else if (modalId === "aiExportModal") {
            generateAIPrompt();
          }
        }
      }
      
      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.remove("show");
        }
      }
      
      function setupShareContent() {
        const filledCount = filledDates.size;
        const shareText = `æˆ‘å·²åœ¨ã€Œé›¢è·é›†é»å¡ã€é›†æ»¿ ${filledCount}/100 é»ï¼å­ä¸–æŒ‡æ•¸ï¼š${document.getElementById("annoyanceIndexTotal").textContent}ï¼Œé›¢è·é€²åº¦ï¼š${Math.round((filledCount / TOTAL_CELLS) * 100)}%ã€‚ä¸€èµ·ä¾†è¨˜éŒ„è·å ´å¿ƒæƒ…å§ï¼`;
        
        document.getElementById("shareAnnoyanceIndex").textContent = `å­ä¸–æŒ‡æ•¸ï¼š${document.getElementById("annoyanceIndexTotal").textContent}`;
        
        // è¨­ç½®è¤‡è£½æŒ‰éˆ•
        document.getElementById("copyLinkBtn").onclick = () => {
          navigator.clipboard.writeText(shareText)
            .then(() => {
              alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
            })
            .catch(err => {
              console.error('ç„¡æ³•è¤‡è£½: ', err);
            });
        };
        
        // è¨­ç½®ç¤¾äº¤åª’é«”åˆ†äº«
        document.getElementById("shareToTwitterBtn").onclick = () => {
          window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`);
        };
        
        document.getElementById("shareToLineBtn").onclick = () => {
          window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(shareText)}`);
        };
        
        document.getElementById("shareToThreadsBtn").onclick = () => {
          // Threads ç›®å‰æ²’æœ‰å®˜æ–¹åˆ†äº« APIï¼Œæ‰€ä»¥åªèƒ½è¤‡è£½æ–‡æœ¬
          navigator.clipboard.writeText(shareText)
            .then(() => {
              alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼è«‹æ‰‹å‹•è²¼åˆ° Threadsã€‚");
            })
            .catch(err => {
              console.error('ç„¡æ³•è¤‡è£½: ', err);
            });
        };
      }
      
      function generateAIPrompt() {
        const filledCount = filledDates.size;
        const annoyanceIndex = document.getElementById("annoyanceIndexTotal").textContent;
        
        // æ”¶é›†å¿ƒæƒ…çµ±è¨ˆ
        const moodMoney = document.getElementById("moodMoneyCount").textContent;
        const moodBurnout = document.getElementById("moodBurnoutCount").textContent;
        const moodAnnoying = document.getElementById("moodAnnoyingCount").textContent;
        const moodStuck = document.getElementById("moodStuckCount").textContent;
        
        // æ”¶é›†æœ€è¿‘çš„è¨˜éŒ„
        const recentRecords = Array.from(filledDates.entries())
          .map(([index, data]) => ({ index, ...data }))
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
          .slice(0, 10)
          .map(record => {
            const moodNames = {
              money: "éŒ¢é€”èŒ«èŒ«",
              burnout: "èº«å¿ƒä¿±ç–²",
              annoying: "é³¥äº‹ä¸€å †",
              stuck: "ç¼ºä¹æˆé•·"
            };
            return `- ${record.date} (${moodNames[record.mood]}): ${record.description || "ç„¡æè¿°"}`;
          })
          .join("\n");
        
        // ç”Ÿæˆ AI Prompt
        const prompt = `# è·å ´å­ä¸–åˆ†æè«‹æ±‚

æˆ‘åœ¨ä½¿ç”¨ã€Œé›¢è·é›†é»å¡ã€è¨˜éŒ„æˆ‘çš„è·å ´å¿ƒæƒ…ï¼Œç›®å‰å·²æ”¶é›†äº† ${filledCount}/100 é»ï¼Œç¸½å­ä¸–æŒ‡æ•¸ç‚º ${annoyanceIndex}ã€‚

## å¿ƒæƒ…åˆ†é¡çµ±è¨ˆ
- éŒ¢é€”èŒ«èŒ«: ${moodMoney} æ¬¡
- èº«å¿ƒä¿±ç–²: ${moodBurnout} æ¬¡
- é³¥äº‹ä¸€å †: ${moodAnnoying} æ¬¡
- ç¼ºä¹æˆé•·: ${moodStuck} æ¬¡

## æœ€è¿‘çš„è¨˜éŒ„
${recentRecords}

è«‹æ ¹æ“šä»¥ä¸Šè³‡æ–™ï¼Œå¹«æˆ‘åˆ†æï¼š
1. æˆ‘ç›®å‰çš„è·å ´å£“åŠ›ç¨‹åº¦å¦‚ä½•ï¼Ÿ
2. æˆ‘æœ€ä¸»è¦çš„è·å ´å›°æ“¾æ˜¯ä»€éº¼ï¼Ÿ
3. æˆ‘æ˜¯å¦æ‡‰è©²è€ƒæ…®å°‹æ‰¾æ–°å·¥ä½œï¼Ÿ
4. æœ‰å“ªäº›å»ºè­°å¯ä»¥æ”¹å–„æˆ‘ç›®å‰çš„è·å ´ç‹€æ³ï¼Ÿ
5. å¦‚æœæˆ‘æ±ºå®šé›¢è·ï¼Œæ‡‰è©²å¦‚ä½•æº–å‚™ï¼Ÿ

è¬è¬ä½ çš„åˆ†æèˆ‡å»ºè­°ï¼`;

        document.getElementById("ai-prompt-output").value = prompt;
        
        // è¨­ç½®è¤‡è£½æŒ‰éˆ•
        document.getElementById("copyAIPromptBtn").onclick = () => {
          const promptText = document.getElementById("ai-prompt-output");
          promptText.select();
          navigator.clipboard.writeText(promptText.value)
            .then(() => {
              alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼å¯ç›´æ¥è²¼åˆ° ChatGPT ç­‰ AI å·¥å…·ä¸­ã€‚");
            })
            .catch(err => {
              console.error('ç„¡æ³•è¤‡è£½: ', err);
            });
        };
      }
      
      function showClearConfirm() {
        openModal("confirmModal");
      }
      
      function confirmClearAll() {
        filledDates.clear();
        saveData();
        generateGrid();
        updateAllStats();
        closeModal("confirmModal");
      }
      
      function addCustomPreset() {
        const input = document.getElementById("customPresetInput");
        const value = input.value.trim();
        
        if (value && !customPresets.includes(value)) {
          customPresets.push(value);
          savePresets();
          renderPresetButtons();
          input.value = "";
        }
      }
      
      function renderPresetButtons() {
        const container = document.getElementById("presetButtonsContainer");
        if (!container) return;
        
        container.innerHTML = "";
        
        customPresets.forEach((preset) => {
          const btn = document.createElement("button");
          btn.className = "bg-gray-100 hover:bg-gray-200 text-gray-800 text-xs px-3 py-1 rounded-full";
          btn.textContent = preset;
          btn.onclick = () => {
            const textarea = document.getElementById("eventDescription");
            textarea.value += (textarea.value ? " " : "") + preset;
          };
          
          container.appendChild(btn);
        });
      }
      
      function openEventModal(index) {
        const modal = document.getElementById("eventModal");
        modal.dataset.currentIndex = index;
        
        const data = filledDates.get(index);
        document.getElementById("eventDate").value = data
          ? data.date
          : toLocalDateStr(new Date());
        document.getElementById("eventDescription").value = data
          ? data.description || ""
          : "";
        
        // è¨­ç½®å¿ƒæƒ…
        document.getElementById("selectedMood").value = data ? data.mood : "";
        document.querySelectorAll(".mood-option").forEach(option => {
          option.classList.toggle("selected", option.dataset.mood === (data ? data.mood : ""));
        });
        
        // ç§»é™¤éŒ¯èª¤æç¤º
        document.getElementById("moodSelector").classList.remove("mood-error");
        document.getElementById("mood-error-message").classList.add("hidden");
        
        // æ¸²æŸ“é è¨­æŒ‰éˆ•
        renderPresetButtons();
        
        modal.classList.remove("hidden");
        modal.classList.add("flex", "modal-open");
      }
    </script>
</html>

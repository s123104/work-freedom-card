<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æˆå°±ç³»çµ±æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold mb-8 text-center">ğŸ† æˆå°±ç³»çµ±åŠŸèƒ½æ¸¬è©¦</h1>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- æ¸¬è©¦æŒ‰éˆ•å€åŸŸ -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h2 class="text-xl font-bold mb-4">æ¸¬è©¦æ“ä½œ</h2>
          <div class="space-y-3">
            <button
              onclick="testFirstFill()"
              class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600"
            >
              <i class="fas fa-play mr-2"></i>æ¸¬è©¦é¦–æ¬¡å¡«å¯«
            </button>
            <button
              onclick="testMoneyMood()"
              class="w-full bg-yellow-500 text-white p-3 rounded-lg hover:bg-yellow-600"
            >
              <i class="fas fa-coins mr-2"></i>æ¸¬è©¦é‡‘éŒ¢å¿ƒæƒ…
            </button>
            <button
              onclick="testBurnoutMood()"
              class="w-full bg-red-500 text-white p-3 rounded-lg hover:bg-red-600"
            >
              <i class="fas fa-fire mr-2"></i>æ¸¬è©¦ç‡ƒç›¡å¿ƒæƒ…
            </button>
            <button
              onclick="testRainbowDay()"
              class="w-full bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600"
            >
              <i class="fas fa-rainbow mr-2"></i>æ¸¬è©¦å½©è™¹æ—¥
            </button>
            <button
              onclick="clearTestData()"
              class="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600"
            >
              <i class="fas fa-trash mr-2"></i>æ¸…é™¤æ¸¬è©¦æ•¸æ“š
            </button>
          </div>
        </div>

        <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h2 class="text-xl font-bold mb-4">æ¸¬è©¦çµæœ</h2>
          <div id="testResults" class="space-y-2 text-sm">
            <p class="text-gray-600">é»æ“Šå·¦å´æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
          </div>
        </div>
      </div>

      <!-- æˆå°±é¡¯ç¤ºå€åŸŸ -->
      <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-bold mb-4">ç•¶å‰æˆå°±ç‹€æ…‹</h2>
        <div
          id="achievementsList"
          class="grid grid-cols-2 md:grid-cols-4 gap-4"
        >
          <!-- æˆå°±å°‡åœ¨é€™è£¡é¡¯ç¤º -->
        </div>
      </div>

      <!-- çµ±è¨ˆæ•¸æ“š -->
      <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-bold mb-4">çµ±è¨ˆæ•¸æ“š</h2>
        <div id="statsDisplay" class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <!-- çµ±è¨ˆæ•¸æ“šå°‡åœ¨é€™è£¡é¡¯ç¤º -->
        </div>
      </div>
    </div>

    <script>
      // æ¨¡æ“¬ä¸»æ‡‰ç”¨çš„æ ¸å¿ƒåŠŸèƒ½
      let filledDates = new Map();
      let achievements = new Map();

      const ACHIEVEMENT_DEFINITIONS = {
        firstStep: {
          name: "åˆæ¬¡è¸å…¥",
          description: "å®Œæˆç¬¬ä¸€å€‹æ ¼å­",
          icon: '<i class="fas fa-running text-green-500"></i>',
          condition: (stats) => stats.totalFilled >= 1,
          category: "å…¥é–€",
          rarity: "common",
        },
        moneyMaster: {
          name: "è³ºéŒ¢ç‹‚é­”",
          description: "é€£çºŒ5å¤©é¸æ“‡é‡‘éŒ¢å¿ƒæƒ…",
          icon: '<i class="fas fa-coins text-yellow-500"></i>',
          condition: (stats) => stats.consecutiveMoney >= 5,
          category: "å¿ƒæƒ…",
          rarity: "uncommon",
        },
        burnoutKing: {
          name: "ç‡ƒç‡’æ®†ç›¡",
          description: "å–®æ—¥ç‡ƒç›¡å¿ƒæƒ…é”åˆ°10æ¬¡",
          icon: '<i class="fas fa-fire text-red-500"></i>',
          condition: (stats) => stats.dailyBurnout >= 10,
          category: "å¿ƒæƒ…",
          rarity: "rare",
        },
        rainbowCollector: {
          name: "å½©è™¹æ”¶é›†è€…",
          description: "ä¸€å¤©å…§é«”é©—æ‰€æœ‰4ç¨®å¿ƒæƒ…",
          icon: '<i class="ri-rainbow-line text-pink-500"></i>',
          condition: (stats) => stats.rainbowDay,
          category: "å¿ƒæƒ…",
          rarity: "epic",
        },
      };

      function addTestResult(message, type = "info") {
        const results = document.getElementById("testResults");
        const colors = {
          info: "text-blue-600",
          success: "text-green-600",
          warning: "text-yellow-600",
          error: "text-red-600",
        };

        const p = document.createElement("p");
        p.className = colors[type] || colors.info;
        p.innerHTML = `<i class="fas fa-circle mr-2"></i>${message}`;
        results.appendChild(p);
        results.scrollTop = results.scrollHeight;
      }

      function testFirstFill() {
        addTestResult("é–‹å§‹æ¸¬è©¦é¦–æ¬¡å¡«å¯«...", "info");

        // æ¨¡æ“¬å¡«å¯«ç¬¬ä¸€å€‹æ ¼å­
        const today = new Date().toISOString().split("T")[0];
        filledDates.set(0, {
          date: today,
          mood: "money",
          description: "æ¸¬è©¦é¦–æ¬¡å¡«å¯«",
          timestamp: new Date().toISOString(),
          annoyanceIndex: 5,
        });

        checkAchievements();
        updateDisplay();
        addTestResult("âœ… é¦–æ¬¡å¡«å¯«æ¸¬è©¦å®Œæˆ", "success");
      }

      function testMoneyMood() {
        addTestResult("é–‹å§‹æ¸¬è©¦é€£çºŒé‡‘éŒ¢å¿ƒæƒ…...", "info");

        // æ¨¡æ“¬é€£çºŒ5å¤©é‡‘éŒ¢å¿ƒæƒ…
        for (let i = 0; i < 5; i++) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split("T")[0];

          filledDates.set(i, {
            date: dateStr,
            mood: "money",
            description: `æ¸¬è©¦é‡‘éŒ¢å¿ƒæƒ…ç¬¬${i + 1}å¤©`,
            timestamp: date.toISOString(),
            annoyanceIndex: 3,
          });
        }

        checkAchievements();
        updateDisplay();
        addTestResult("âœ… é€£çºŒé‡‘éŒ¢å¿ƒæƒ…æ¸¬è©¦å®Œæˆ", "success");
      }

      function testBurnoutMood() {
        addTestResult("é–‹å§‹æ¸¬è©¦ç‡ƒç›¡å¿ƒæƒ…...", "info");

        // æ¨¡æ“¬å–®æ—¥10æ¬¡ç‡ƒç›¡å¿ƒæƒ…
        const today = new Date().toISOString().split("T")[0];
        for (let i = 0; i < 10; i++) {
          filledDates.set(100 + i, {
            date: today,
            mood: "burnout",
            description: `æ¸¬è©¦ç‡ƒç›¡å¿ƒæƒ…ç¬¬${i + 1}æ¬¡`,
            timestamp: new Date().toISOString(),
            annoyanceIndex: 8,
          });
        }

        checkAchievements();
        updateDisplay();
        addTestResult("âœ… ç‡ƒç›¡å¿ƒæƒ…æ¸¬è©¦å®Œæˆ", "success");
      }

      function testRainbowDay() {
        addTestResult("é–‹å§‹æ¸¬è©¦å½©è™¹æ—¥...", "info");

        // æ¨¡æ“¬ä¸€å¤©å…§æ‰€æœ‰4ç¨®å¿ƒæƒ…
        const today = new Date().toISOString().split("T")[0];
        const moods = ["money", "burnout", "annoying", "stuck"];

        moods.forEach((mood, index) => {
          filledDates.set(200 + index, {
            date: today,
            mood: mood,
            description: `æ¸¬è©¦${mood}å¿ƒæƒ…`,
            timestamp: new Date().toISOString(),
            annoyanceIndex: 5,
          });
        });

        checkAchievements();
        updateDisplay();
        addTestResult("âœ… å½©è™¹æ—¥æ¸¬è©¦å®Œæˆ", "success");
      }

      function clearTestData() {
        filledDates.clear();
        achievements.clear();
        updateDisplay();
        document.getElementById("testResults").innerHTML =
          '<p class="text-gray-600">æ¸¬è©¦æ•¸æ“šå·²æ¸…é™¤</p>';
        addTestResult("ğŸ—‘ï¸ æ¸¬è©¦æ•¸æ“šå·²æ¸…é™¤", "warning");
      }

      function calculateUserStats() {
        const today = new Date().toISOString().split("T")[0];
        const filledArray = Array.from(filledDates.values());

        return {
          totalFilled: filledDates.size,
          consecutiveMoney: calculateConsecutiveMood("money"),
          dailyBurnout: calculateDailyMoodCount("burnout", today),
          rainbowDay: checkRainbowDay(today),
        };
      }

      function calculateConsecutiveMood(mood) {
        const today = new Date();
        let consecutive = 0;

        for (let i = 0; i < 30; i++) {
          const checkDate = new Date(today);
          checkDate.setDate(today.getDate() - i);
          const dateStr = checkDate.toISOString().split("T")[0];

          let hasMood = false;
          filledDates.forEach((data) => {
            if (data.date === dateStr && data.mood === mood) {
              hasMood = true;
            }
          });

          if (hasMood) {
            consecutive++;
          } else {
            break;
          }
        }
        return consecutive;
      }

      function calculateDailyMoodCount(mood, date) {
        let count = 0;
        filledDates.forEach((data) => {
          if (data.date === date && data.mood === mood) {
            count++;
          }
        });
        return count;
      }

      function checkRainbowDay(date) {
        const moods = new Set();
        filledDates.forEach((data) => {
          if (data.date === date) {
            moods.add(data.mood);
          }
        });
        return moods.size >= 4;
      }

      function checkAchievements() {
        const stats = calculateUserStats();
        let newAchievements = [];

        Object.entries(ACHIEVEMENT_DEFINITIONS).forEach(
          ([key, achievement]) => {
            if (!achievements.has(key) && achievement.condition(stats)) {
              achievements.set(key, {
                ...achievement,
                unlockedAt: new Date().toISOString(),
                id: key,
              });
              newAchievements.push(achievement);
              addTestResult(`ğŸ‰ è§£é–æˆå°±: ${achievement.name}`, "success");
            }
          }
        );
      }

      function updateDisplay() {
        updateAchievementsList();
        updateStatsDisplay();
      }

      function updateAchievementsList() {
        const container = document.getElementById("achievementsList");
        container.innerHTML = "";

        Object.entries(ACHIEVEMENT_DEFINITIONS).forEach(
          ([key, achievement]) => {
            const isUnlocked = achievements.has(key);
            const div = document.createElement("div");
            div.className = `p-4 rounded-lg border-2 text-center ${
              isUnlocked
                ? "bg-green-50 border-green-200"
                : "bg-gray-50 border-gray-200 opacity-50"
            }`;

            div.innerHTML = `
                    <div class="text-2xl mb-2">${achievement.icon}</div>
                    <div class="font-bold text-sm">${achievement.name}</div>
                    <div class="text-xs text-gray-600 mt-1">${
                      achievement.description
                    }</div>
                    <div class="text-xs mt-2 ${
                      isUnlocked ? "text-green-600" : "text-gray-400"
                    }">
                        ${isUnlocked ? "âœ… å·²è§£é–" : "ğŸ”’ æœªè§£é–"}
                    </div>
                `;

            container.appendChild(div);
          }
        );
      }

      function updateStatsDisplay() {
        const stats = calculateUserStats();
        const container = document.getElementById("statsDisplay");

        container.innerHTML = `
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600">${
                      stats.totalFilled
                    }</div>
                    <div class="text-sm text-blue-800">ç¸½å¡«å¯«æ•¸</div>
                </div>
                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-600">${
                      stats.consecutiveMoney
                    }</div>
                    <div class="text-sm text-yellow-800">é€£çºŒé‡‘éŒ¢å¿ƒæƒ…</div>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <div class="text-2xl font-bold text-red-600">${
                      stats.dailyBurnout
                    }</div>
                    <div class="text-sm text-red-800">ä»Šæ—¥ç‡ƒç›¡æ¬¡æ•¸</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600">${
                      stats.rainbowDay ? "æ˜¯" : "å¦"
                    }</div>
                    <div class="text-sm text-purple-800">å½©è™¹æ—¥</div>
                </div>
            `;
      }

      // åˆå§‹åŒ–é¡¯ç¤º
      updateDisplay();
    </script>
  </body>
</html>
